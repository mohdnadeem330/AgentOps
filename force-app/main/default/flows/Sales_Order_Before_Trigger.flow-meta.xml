<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <apiVersion>61.0</apiVersion>
    <areMetricsLoggedToDataCloud>false</areMetricsLoggedToDataCloud>
    <assignments>
        <name>Add_Acc_Id_to_to_Variable</name>
        <label>Add Acc Id to to Variable</label>
        <locationX>699</locationX>
        <locationY>2219</locationY>
        <assignmentItems>
            <assignToReference>accountIds</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>Loop_in_Sales_Order.Account__r.Id</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Store_Same_Project_SO</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Same_Project_SO</name>
        <label>Same Project SO</label>
        <locationX>567</locationX>
        <locationY>2435</locationY>
        <assignmentItems>
            <assignToReference>sameProjectSOIds</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>Loop_in_Sales_Order.Id</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Loop_in_Sales_Order</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Set_First_Time_Buyer</name>
        <label>Set First Time Buyer</label>
        <locationX>710</locationX>
        <locationY>2819</locationY>
        <assignmentItems>
            <assignToReference>$Record.FirstTimeBuyer__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </assignmentItems>
    </assignments>
    <assignments>
        <name>Sub_Status_to_Sales_Admin</name>
        <label>Sub Status to Sales Admin</label>
        <locationX>594</locationX>
        <locationY>395</locationY>
        <assignmentItems>
            <assignToReference>$Record.SubStatus__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>Pending with Sales Admin</stringValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Status_is_Reservation_In_Progress_for_Extension_Days</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Update_Sub_Status</name>
        <label>Update Sub Status</label>
        <locationX>330</locationX>
        <locationY>395</locationY>
        <assignmentItems>
            <assignToReference>$Record.SubStatus__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>Pending with Sales Manager</stringValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Status_is_Reservation_In_Progress_for_Extension_Days</targetReference>
        </connector>
    </assignments>
    <decisions>
        <name>Check_If_Bank_name_is_There</name>
        <label>Check If Bank name is There</label>
        <locationX>726</locationX>
        <locationY>1187</locationY>
        <defaultConnector>
            <targetReference>Inventory_and_Launch_Setup</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Bank_is_not_blank</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>IsNew</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.CorporateWealthName__c</leftValueReference>
                <operator>IsBlank</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Fetch_Wealth_Partner_Mapping_By_Bank_Name</targetReference>
            </connector>
            <label>Bank is not blank</label>
        </rules>
    </decisions>
    <decisions>
        <name>Decision_7</name>
        <label>Is Same Project</label>
        <locationX>248</locationX>
        <locationY>2819</locationY>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Same_project_SO_Outcome</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>sameProjectSOIds</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Get_The_Same_Project_SO</targetReference>
            </connector>
            <label>Same project SO Outcome</label>
        </rules>
    </decisions>
    <decisions>
        <name>Existing_New_Customer_Entry</name>
        <label>Existing / New Customer Entry</label>
        <locationX>726</locationX>
        <locationY>1895</locationY>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Is_Applicable</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Id</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Get_Existing_Account_Active_Sales_Order</targetReference>
            </connector>
            <label>Is Applicable</label>
        </rules>
    </decisions>
    <decisions>
        <name>Inventory_and_Launch_Setup</name>
        <label>Inventory and Launch Setup</label>
        <locationX>726</locationX>
        <locationY>1595</locationY>
        <defaultConnector>
            <targetReference>Existing_New_Customer_Entry</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Has_Offer_in_Sales_Order</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Offer__c</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.Offer__r.Inventory_and_Launch__c</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.Offer__r.Inventory_and_Launch__c</leftValueReference>
                <operator>NotEqualTo</operator>
                <rightValue>
                    <elementReference>$Record.InventoryLaunch__c</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Update_Inventory_And_Launch</targetReference>
            </connector>
            <label>Has Offer in Sales Order</label>
        </rules>
    </decisions>
    <decisions>
        <name>Is_Booking_Date_n_days</name>
        <label>Is Booking Date &gt; n days</label>
        <locationX>50</locationX>
        <locationY>3035</locationY>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Outcome_1_of_Is_Booking_Date_n_days</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>BookingDateDiffrence</leftValueReference>
                <operator>LessThanOrEqualTo</operator>
                <rightValue>
                    <elementReference>DaysDifference</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <isGoTo>true</isGoTo>
                <targetReference>Set_First_Time_Buyer</targetReference>
            </connector>
            <label>Outcome 1 of Is Booking Date &gt; n days</label>
        </rules>
    </decisions>
    <decisions>
        <name>Is_Customer_Existing</name>
        <label>Is Customer Existing</label>
        <locationX>479</locationX>
        <locationY>2711</locationY>
        <defaultConnector>
            <targetReference>Set_First_Time_Buyer</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Is_Existing</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>accountIds</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Decision_7</targetReference>
            </connector>
            <label>Is Existing</label>
        </rules>
    </decisions>
    <decisions>
        <name>Status_is_Reservation_In_Progress_for_Extension_Days</name>
        <label>Status is Reservation In Progress for Extension Days</label>
        <locationX>726</locationX>
        <locationY>587</locationY>
        <defaultConnector>
            <targetReference>Update_Approval_Status_on_Cancellation_by_Approval</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Check_record_is_created_Reserved</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Status__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Reservation In Progress</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>IsNew</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.Unit__r.Project__r.Skip_Reservation_Cancellation__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Label.Cancellation_Reservation_Switch</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>true</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Update_Cancellation_Deadline_Date</targetReference>
            </connector>
            <label>Check record is created Reserved</label>
        </rules>
        <rules>
            <name>Reservation_Deadline_Extended_After_LM_Approved</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Approval_Status__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>LM Approved</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Label.Cancellation_Reservation_Switch</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>true</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Update_Cancellation_Deadline_Date_2</targetReference>
            </connector>
            <doesRequireRecordChangedToMeetCriteria>true</doesRequireRecordChangedToMeetCriteria>
            <label>Reservation Deadline Extended After LM Approved</label>
        </rules>
        <rules>
            <name>Reservation_Deadline_Extended_After_SO_Approved</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Approval_Status__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>SO Approved</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Label.Cancellation_Reservation_Switch</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>true</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Update_Cancellation_Deadline_Date_3</targetReference>
            </connector>
            <doesRequireRecordChangedToMeetCriteria>true</doesRequireRecordChangedToMeetCriteria>
            <label>Reservation Deadline Extended After SO Approved</label>
        </rules>
    </decisions>
    <decisions>
        <name>Store_Same_Project_SO</name>
        <label>Store Same Project SO</label>
        <locationX>699</locationX>
        <locationY>2327</locationY>
        <defaultConnector>
            <targetReference>Loop_in_Sales_Order</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Is_Same_Project</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Loop_in_Sales_Order.Project_Name__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <elementReference>$Record.Project_Name__c</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Same_Project_SO</targetReference>
            </connector>
            <label>Is Same Project</label>
        </rules>
    </decisions>
    <decisions>
        <name>Sub_Status_verification</name>
        <label>Sub Status verification</label>
        <locationX>726</locationX>
        <locationY>287</locationY>
        <defaultConnector>
            <targetReference>Status_is_Reservation_In_Progress_for_Extension_Days</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>ComplianceReturned</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.SubStatus__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Pending for Compliance</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.ComplianceStatus__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Returned</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record__Prior.ComplianceStatus__c</leftValueReference>
                <operator>NotEqualTo</operator>
                <rightValue>
                    <stringValue>Returned</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Update_Sub_Status</targetReference>
            </connector>
            <label>Compliance Returned?</label>
        </rules>
        <rules>
            <name>Compliance_Cleared</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.SubStatus__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Pending for Compliance</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record__Prior.ComplianceStatus__c</leftValueReference>
                <operator>NotEqualTo</operator>
                <rightValue>
                    <stringValue>Cleared</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.ComplianceStatus__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Cleared</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Sub_Status_to_Sales_Admin</targetReference>
            </connector>
            <label>Compliance Cleared?</label>
        </rules>
        <rules>
            <name>check_Manager_Availability</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.SalesManager__c</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.SalesManager__r.ManagerId</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Update_the_Line_Manager</targetReference>
            </connector>
            <label>check Manager Availability</label>
        </rules>
    </decisions>
    <decisions>
        <name>Update_Approval_Status_on_Cancellation_by_Approval</name>
        <label>Update Approval Status on Cancellation by Approval</label>
        <locationX>726</locationX>
        <locationY>887</locationY>
        <defaultConnector>
            <targetReference>Check_If_Bank_name_is_There</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Sales_Order_Cancellation_By_Line_Manager</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Status__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Cancelled</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.Approval_Status__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Pending LM</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.Reservation_Cancellation_Stage__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Awaiting LM Approval</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Label.Cancellation_Reservation_Switch</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>true</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Update_Approval_Status</targetReference>
            </connector>
            <doesRequireRecordChangedToMeetCriteria>true</doesRequireRecordChangedToMeetCriteria>
            <label>Sales Order Cancellation By Line Manager</label>
        </rules>
        <rules>
            <name>Sales_Order_Cancellation_By_Sales_Ops</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Status__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Cancelled</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.Approval_Status__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Pending SO</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.Reservation_Cancellation_Stage__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Escalated to SO</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Label.Cancellation_Reservation_Switch</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>true</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Update_Approval_Status_1</targetReference>
            </connector>
            <label>Sales Order Cancellation By Sales Ops</label>
        </rules>
    </decisions>
    <environments>Default</environments>
    <formulas>
        <name>BankName</name>
        <dataType>String</dataType>
        <expression>Text({!$Record.Account__r.CorporateWealthName__c})</expression>
    </formulas>
    <formulas>
        <name>BookingDateDiffrence</name>
        <dataType>Number</dataType>
        <expression>ABS({!$Record.BookingDate__c} - {!Get_The_Same_Project_SO.BookingDate__c})</expression>
        <scale>2</scale>
    </formulas>
    <formulas>
        <name>CancellationDeadlineExtensionDate</name>
        <dataType>Date</dataType>
        <expression>IF(ISPICKVAL({!$Record.Approval_Status__c}, &apos;LM Approved&apos;), ({!$Record.Cancellation_Deadline__c} + 2), ({!$Record.Cancellation_Deadline__c} + 3))</expression>
    </formulas>
    <formulas>
        <name>DaysDifference</name>
        <dataType>Number</dataType>
        <expression>VALUE({!$Label.Sales_Order_Day_Difference})</expression>
        <scale>0</scale>
    </formulas>
    <formulas>
        <name>InitalCancellationDeadlineDate</name>
        <dataType>Date</dataType>
        <expression>If(Not(ISNULL({!$Record.ReservationStartDate__c})), {!$Record.ReservationStartDate__c}+ 2, NULL)</expression>
    </formulas>
    <formulas>
        <name>IsNew</name>
        <dataType>Boolean</dataType>
        <expression>ISNEW()</expression>
    </formulas>
    <interviewLabel>Sales Order Before Trigger {!$Flow.CurrentDateTime}</interviewLabel>
    <label>Sales Order Before Trigger</label>
    <loops>
        <name>Loop_in_Sales_Order</name>
        <label>Loop in Sales Order</label>
        <locationX>479</locationX>
        <locationY>2111</locationY>
        <collectionReference>Get_Existing_Account_Active_Sales_Order</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Add_Acc_Id_to_to_Variable</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Is_Customer_Existing</targetReference>
        </noMoreValuesConnector>
    </loops>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>AUTO_LAYOUT_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>AutoLaunchedFlow</processType>
    <recordLookups>
        <name>Fetch_Wealth_Partner_Mapping_By_Bank_Name</name>
        <label>Fetch Wealth Partner Mapping By Bank Name</label>
        <locationX>594</locationX>
        <locationY>1295</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Update_Corporate_Wealth_Name</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Bank_Name__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.CorporateWealthName__c</elementReference>
            </value>
        </filters>
        <filters>
            <field>End_Date__c</field>
            <operator>GreaterThan</operator>
            <value>
                <elementReference>$Flow.CurrentDate</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>Wealth_Partner_Mapping__mdt</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>Get_Existing_Account_Active_Sales_Order</name>
        <label>Get Existing Account Active Sales Order</label>
        <locationX>479</locationX>
        <locationY>2003</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Loop_in_Sales_Order</targetReference>
        </connector>
        <filterLogic>1  AND (2 OR 3 OR 4 OR 5 OR 6 OR 7)</filterLogic>
        <filters>
            <field>Account__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.Account__r.Id</elementReference>
            </value>
        </filters>
        <filters>
            <field>Status__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Sold</stringValue>
            </value>
        </filters>
        <filters>
            <field>Status__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Pending</stringValue>
            </value>
        </filters>
        <filters>
            <field>Status__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Approve Pending</stringValue>
            </value>
        </filters>
        <filters>
            <field>Status__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>In Progress</stringValue>
            </value>
        </filters>
        <filters>
            <field>Status__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Reserved</stringValue>
            </value>
        </filters>
        <filters>
            <field>Status__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>RTO Sold</stringValue>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>SalesOrder__c</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>Get_The_Same_Project_SO</name>
        <label>Get The Same Project SO</label>
        <locationX>50</locationX>
        <locationY>2927</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Is_Booking_Date_n_days</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>In</operator>
            <value>
                <elementReference>sameProjectSOIds</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>SalesOrder__c</object>
        <sortField>BookingDate__c</sortField>
        <sortOrder>Desc</sortOrder>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordUpdates>
        <name>Update_Approval_Status</name>
        <label>Update Approval Status</label>
        <locationX>462</locationX>
        <locationY>995</locationY>
        <connector>
            <targetReference>Check_If_Bank_name_is_There</targetReference>
        </connector>
        <inputAssignments>
            <field>Approval_Status__c</field>
            <value>
                <stringValue>LM Rejected</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Reservation_Cancellation_Stage__c</field>
            <value>
                <stringValue>Cancelled by LM</stringValue>
            </value>
        </inputAssignments>
        <inputReference>$Record</inputReference>
    </recordUpdates>
    <recordUpdates>
        <name>Update_Approval_Status_1</name>
        <label>Update Approval Status</label>
        <locationX>726</locationX>
        <locationY>995</locationY>
        <connector>
            <targetReference>Check_If_Bank_name_is_There</targetReference>
        </connector>
        <inputAssignments>
            <field>Approval_Status__c</field>
            <value>
                <stringValue>SO Rejected</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Reservation_Cancellation_Stage__c</field>
            <value>
                <stringValue>Cancelled by SO</stringValue>
            </value>
        </inputAssignments>
        <inputReference>$Record</inputReference>
    </recordUpdates>
    <recordUpdates>
        <name>Update_Cancellation_Deadline_Date</name>
        <label>Update Cancellation Deadline Date</label>
        <locationX>330</locationX>
        <locationY>695</locationY>
        <connector>
            <targetReference>Update_Approval_Status_on_Cancellation_by_Approval</targetReference>
        </connector>
        <inputAssignments>
            <field>Cancellation_Deadline__c</field>
            <value>
                <elementReference>InitalCancellationDeadlineDate</elementReference>
            </value>
        </inputAssignments>
        <inputReference>$Record</inputReference>
    </recordUpdates>
    <recordUpdates>
        <name>Update_Cancellation_Deadline_Date_2</name>
        <label>Update Cancellation Deadline Date</label>
        <locationX>594</locationX>
        <locationY>695</locationY>
        <connector>
            <targetReference>Update_Approval_Status_on_Cancellation_by_Approval</targetReference>
        </connector>
        <inputAssignments>
            <field>Cancellation_Deadline__c</field>
            <value>
                <elementReference>CancellationDeadlineExtensionDate</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Reservation_Cancellation_Stage__c</field>
            <value>
                <stringValue>Extension Granted by LM</stringValue>
            </value>
        </inputAssignments>
        <inputReference>$Record</inputReference>
    </recordUpdates>
    <recordUpdates>
        <name>Update_Cancellation_Deadline_Date_3</name>
        <label>Update Cancellation Deadline Date</label>
        <locationX>858</locationX>
        <locationY>695</locationY>
        <connector>
            <targetReference>Update_Approval_Status_on_Cancellation_by_Approval</targetReference>
        </connector>
        <inputAssignments>
            <field>Cancellation_Deadline__c</field>
            <value>
                <elementReference>CancellationDeadlineExtensionDate</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Reservation_Cancellation_Stage__c</field>
            <value>
                <stringValue>Final Extension Granted</stringValue>
            </value>
        </inputAssignments>
        <inputReference>$Record</inputReference>
    </recordUpdates>
    <recordUpdates>
        <name>Update_Corporate_Wealth_Name</name>
        <label>Update Corporate Wealth Name</label>
        <locationX>594</locationX>
        <locationY>1403</locationY>
        <connector>
            <targetReference>Inventory_and_Launch_Setup</targetReference>
        </connector>
        <inputAssignments>
            <field>CorporateWealthManagerName__c</field>
            <value>
                <elementReference>Fetch_Wealth_Partner_Mapping_By_Bank_Name.Wealth_Manager_Name__c</elementReference>
            </value>
        </inputAssignments>
        <inputReference>$Record</inputReference>
    </recordUpdates>
    <recordUpdates>
        <name>Update_Inventory_And_Launch</name>
        <label>Update Inventory And Launch</label>
        <locationX>594</locationX>
        <locationY>1703</locationY>
        <connector>
            <targetReference>Existing_New_Customer_Entry</targetReference>
        </connector>
        <inputAssignments>
            <field>InventoryLaunch__c</field>
            <value>
                <elementReference>$Record.Offer__r.Inventory_and_Launch__c</elementReference>
            </value>
        </inputAssignments>
        <inputReference>$Record</inputReference>
    </recordUpdates>
    <recordUpdates>
        <name>Update_the_Line_Manager</name>
        <label>Update the Line Manager</label>
        <locationX>858</locationX>
        <locationY>395</locationY>
        <connector>
            <targetReference>Status_is_Reservation_In_Progress_for_Extension_Days</targetReference>
        </connector>
        <inputAssignments>
            <field>LineManager__c</field>
            <value>
                <elementReference>$Record.SalesManager__r.ManagerId</elementReference>
            </value>
        </inputAssignments>
        <inputReference>$Record</inputReference>
    </recordUpdates>
    <start>
        <locationX>600</locationX>
        <locationY>0</locationY>
        <connector>
            <targetReference>Sub_Status_verification</targetReference>
        </connector>
        <object>SalesOrder__c</object>
        <recordTriggerType>CreateAndUpdate</recordTriggerType>
        <triggerType>RecordBeforeSave</triggerType>
    </start>
    <status>Active</status>
    <variables>
        <name>accIdLst</name>
        <dataType>String</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>accountIds</name>
        <dataType>String</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>currentItemFromSourceCollection</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>SalesOrder__c</objectType>
    </variables>
    <variables>
        <name>sameProjectLatestBookingDate</name>
        <dataType>Date</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>sameProjectSOIds</name>
        <dataType>String</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>sameProjectSOLst</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>SalesOrder__c</objectType>
    </variables>
</Flow>
