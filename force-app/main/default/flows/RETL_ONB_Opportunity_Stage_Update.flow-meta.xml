<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <apiVersion>65.0</apiVersion>
    <areMetricsLoggedToDataCloud>false</areMetricsLoggedToDataCloud>
    <assignments>
        <name>Assign_Service_Request_Data</name>
        <label>Assign Service Request Data</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <assignmentItems>
            <assignToReference>ServiceRequestData.RETL_Account_Id__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>$Record.AccountId</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>ServiceRequestData.RETL_Subject__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>New Service Request</stringValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>ServiceRequestData.RETL_Status__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>New</stringValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>ServiceRequestData.RETL_Description__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>New Service Request</stringValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>ServiceRequestData.OwnerId</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Get_Service_Request_Template_Record.RETL_Senior_Delivery_Manager__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>ServiceRequestData.RETL_Startdate__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>CurrentDateTime</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>ServiceRequestData.RETL_Priority__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>High</stringValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>ServiceRequestData.RETL_Senior_Delivery_Manager__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Get_Service_Request_Template_Record.RETL_Senior_Delivery_Manager__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>ServiceRequestData.RETL_Leasing_Admin__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Get_Service_Request_Template_Record.RETL_Leasing_Admin__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>ServiceRequestData.RETL_Leasing_Manager__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>$Record.OwnerId</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>ServiceRequestData.RETL_Service_Request_Instructions__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Get_Service_Request_Template_Record.RETL_Service_Request_Instructions__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>ServiceRequestData.Workflow_Service_Request_Template__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Get_Service_Request_Template_Record.Id</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>ServiceRequestData.RETL_Opportunity_Id__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>ServiceRequestData.RETL_RDD_Manager__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Get_Service_Request_Template_Record.RDD_Manager__c</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Create_Service_Requests</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Assigned_Primary_Contact_Id_to_Service_Request</name>
        <label>Assigned Primary Contact Id to Service Request</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <assignmentItems>
            <assignToReference>ServiceRequestData.RETL_Tenant__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Get_Primary_Contact.Id</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Assign_Service_Request_Data</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Assigning_Stage_Data</name>
        <label>Assigning Stage Data</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <assignmentItems>
            <assignToReference>StageRecords.RETL_Service_RequestId__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>ServiceRequestData.Id</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>StageRecords.StageTemplateId__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_Stage_Templates.Id</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>StageRecords.Status__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>Not Started</stringValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>StageRecords.Name</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_Stage_Templates.Name</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>StageRecords.RETL_Stage_Developer_Name__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_Stage_Templates.RETL_Stage_Developer_Name__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>StageRecords.RETL_Stage_Instructions__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_Stage_Templates.RETL_Stage_Instructions__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>StageRecords.Sequence__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_Stage_Templates.Default_Sequence__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>StageRecords.Start_Date__c</assignToReference>
            <operator>Assign</operator>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>StageRecords.RETL_Site_Inspection_Status__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_Stage_Templates.RETL_Site_Inspection_Status__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>StageRecords.RETL_Category__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_Stage_Templates.RETL_Category__c</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Assigning_Stage_records_to_Collection</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Assigning_Stage_records_to_Collection</name>
        <label>Assigning Stage records to Collection</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <assignmentItems>
            <assignToReference>StageCollection</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>StageRecords</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Loop_Stage_Templates</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Update_Move_in_Date_on_Order</name>
        <label>Update Move-in Date on Order</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <assignmentItems>
            <assignToReference>Get_Order_exist_on_Oppo.RETL_MoveInDate__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>$Record.Start_date__c</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Update_Order_related_to_opportunity</targetReference>
        </connector>
    </assignments>
    <decisions>
        <name>Check_Existing_Service_Request</name>
        <label>Check Existing Service Request</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>No_Service_Request</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Get_Existing_Service_Request</leftValueReference>
                <operator>IsEmpty</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Check_if_Retail_Opportunity</targetReference>
            </connector>
            <label>No Service Request</label>
        </rules>
    </decisions>
    <decisions>
        <name>Check_for_Organization_Account</name>
        <label>Check for Organization Account</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <defaultConnector>
            <targetReference>Assign_Service_Request_Data</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>If_Organization_Account</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>OrganizationAccountRecordType</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Get_Primary_Contact</targetReference>
            </connector>
            <label>If Organization Account</label>
        </rules>
    </decisions>
    <decisions>
        <name>Check_if_Order_exist</name>
        <label>Check if Order exist</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <defaultConnector>
            <targetReference>Opportunity_Stage_Proposal_Stage</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>If_Yes</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Get_Order_exist_on_Oppo</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.Start_date__c</leftValueReference>
                <operator>IsChanged</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Update_Move_in_Date_on_Order</targetReference>
            </connector>
            <label>If Yes</label>
        </rules>
    </decisions>
    <decisions>
        <name>Check_if_Retail_Opportunity</name>
        <label>Check if Retail Opportunity</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Is_Retail_Lease_Record_Type</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>RetailOppRecordTypeId</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Get_Service_Request_Template_Record</targetReference>
            </connector>
            <label>Is Retail Lease Record Type</label>
        </rules>
    </decisions>
    <decisions>
        <name>Check_if_Service_Request_exist</name>
        <label>Check if Service Request exist</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <defaultConnector>
            <targetReference>Opportunity_Stage_Proposal_Stage</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>If_SR_found</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Get_Service_Request_Order</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Get_Order_exist_on_Oppo</targetReference>
            </connector>
            <label>If SR found</label>
        </rules>
    </decisions>
    <decisions>
        <name>Opportunity_Stage_Proposal_Stage</name>
        <label>Opportunity Stage/Proposal Stage</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>LC_Approved_Stage</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.StageName</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>LC Approved</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.StageName</leftValueReference>
                <operator>IsChanged</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Setup.RETL_Setting__c.RETL_Create_Workflow_Request__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Get_Existing_Service_Request</targetReference>
            </connector>
            <label>LC Approved Stage</label>
        </rules>
    </decisions>
    <description>removed the existing SR error</description>
    <environments>Default</environments>
    <formulas>
        <name>CurrentDateTime</name>
        <dataType>DateTime</dataType>
        <expression>NOW()</expression>
    </formulas>
    <formulas>
        <name>OrganizationAccountRecordType</name>
        <dataType>Boolean</dataType>
        <expression>{!Get_Accounts_from_Opportunity.RecordType.DeveloperName} =&quot;OrganizationAccount&quot;</expression>
    </formulas>
    <formulas>
        <name>RetailOppRecordTypeId</name>
        <dataType>Boolean</dataType>
        <expression>{!$Record.RecordType.DeveloperName} = &quot;RETL_Opportunity&quot;</expression>
    </formulas>
    <interviewLabel>RETL ONB Opportunity Stage Update {!$Flow.CurrentDateTime}</interviewLabel>
    <label>RETL ONB Opportunity Stage Update</label>
    <loops>
        <name>Loop_Stage_Templates</name>
        <label>Loop Stage Templates</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <collectionReference>Get_Stage_Template_Records</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Assigning_Stage_Data</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Create_Stage_Record</targetReference>
        </noMoreValuesConnector>
    </loops>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>AUTO_LAYOUT_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>AutoLaunchedFlow</processType>
    <recordCreates>
        <name>Create_Service_Requests</name>
        <label>Create Service Requests</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <connector>
            <targetReference>Get_Stage_Template_Records</targetReference>
        </connector>
        <inputReference>ServiceRequestData</inputReference>
    </recordCreates>
    <recordCreates>
        <name>Create_Stage_Record</name>
        <label>Create Stage Record</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <inputReference>StageCollection</inputReference>
    </recordCreates>
    <recordLookups>
        <name>Get_Accounts_from_Opportunity</name>
        <label>Get Accounts from Opportunity</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Check_for_Organization_Account</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.AccountId</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>Account</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>Get_Existing_Service_Request</name>
        <label>Get Existing Service Request</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Check_Existing_Service_Request</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>RETL_Opportunity_Id__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>RETL_Service_Request__c</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>Get_Order_exist_on_Oppo</name>
        <label>Get Order exist on Oppo</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Check_if_Order_exist</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>Get_Service_Request_Order.RETL_Order__c</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>Order</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>Get_Primary_Contact</name>
        <label>Get Primary Contact</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Assigned_Primary_Contact_Id_to_Service_Request</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>PrimaryContact__c</field>
            <operator>EqualTo</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <filters>
            <field>AccountId</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>Get_Accounts_from_Opportunity.Id</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>Contact</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>Get_Service_Request_Order</name>
        <label>Get Service Request Order</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Check_if_Service_Request_exist</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>RETL_Opportunity_Id__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>RETL_Service_Request__c</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>Get_Service_Request_Template_Record</name>
        <label>Get Service Request Template Record</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Get_Accounts_from_Opportunity</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Name</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Retail Tenant Onboarding</stringValue>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>RETL_Service_Request_Template__c</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>Get_Stage_Template_Records</name>
        <label>Get Stage Template Records</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Loop_Stage_Templates</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>WorkflowServiceRequestTemplateId__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>Get_Service_Request_Template_Record.Id</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>RETL_Stage_Template__c</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordUpdates>
        <name>Update_Order_related_to_opportunity</name>
        <label>Update Order related to opportunity</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <connector>
            <targetReference>Opportunity_Stage_Proposal_Stage</targetReference>
        </connector>
        <inputReference>Get_Order_exist_on_Oppo</inputReference>
    </recordUpdates>
    <start>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <connector>
            <targetReference>Get_Service_Request_Order</targetReference>
        </connector>
        <filterFormula>{!$Record.RecordType.DeveloperName} =&apos;RETL_Opportunity&apos;</filterFormula>
        <object>Opportunity</object>
        <recordTriggerType>Update</recordTriggerType>
        <triggerType>RecordAfterSave</triggerType>
    </start>
    <status>Active</status>
    <variables>
        <name>createServiceRequests</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>RETL_Service_Request__c</objectType>
    </variables>
    <variables>
        <name>ServiceRequestData</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>RETL_Service_Request__c</objectType>
    </variables>
    <variables>
        <name>StageCollection</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>RETL_Stage__c</objectType>
    </variables>
    <variables>
        <name>StageRecords</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>RETL_Stage__c</objectType>
    </variables>
</Flow>
