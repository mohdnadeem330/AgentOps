<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <actionCalls>
        <name>Send_Email_Notification_of_Unit_Reservation</name>
        <label>Send Email Notification of  Unit Reservation</label>
        <locationX>50</locationX>
        <locationY>539</locationY>
        <actionName>SalesOrder__c.Notify_Customer_After_Unit_is_Reserved</actionName>
        <actionType>emailAlert</actionType>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>SObjectRowId</name>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </inputParameters>
        <nameSegment>SalesOrder__c.Notify_Customer_After_Unit_is_Reserved</nameSegment>
        <offset>0</offset>
    </actionCalls>
    <apiVersion>63.0</apiVersion>
    <areMetricsLoggedToDataCloud>false</areMetricsLoggedToDataCloud>
    <decisions>
        <name>Null_Check_for_Email_Template</name>
        <label>Null Check for Email Template</label>
        <locationX>314</locationX>
        <locationY>431</locationY>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Check_for_Email_Template</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Get_the_Email_Template</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>Get_the_Email_Template</leftValueReference>
                <operator>IsBlank</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.Email__c</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.Email__c</leftValueReference>
                <operator>IsBlank</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Send_Email_Notification_of_Unit_Reservation</targetReference>
            </connector>
            <label>Check for Email Template</label>
        </rules>
    </decisions>
    <environments>Default</environments>
    <interviewLabel>Send Email Notification on Unit Reservation {!$Flow.CurrentDateTime}</interviewLabel>
    <label>Send Email Notification on Unit Reservation</label>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>AUTO_LAYOUT_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>AutoLaunchedFlow</processType>
    <recordLookups>
        <name>Get_the_Email_Template</name>
        <label>Get the Email Template</label>
        <locationX>314</locationX>
        <locationY>323</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Null_Check_for_Email_Template</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>DeveloperName</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Unit_Reservation_Completed</stringValue>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>EmailTemplate</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <start>
        <locationX>188</locationX>
        <locationY>0</locationY>
        <connector>
            <targetReference>Get_the_Email_Template</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Status__c</field>
            <operator>IsChanged</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <filters>
            <field>Status__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Reserved</stringValue>
            </value>
        </filters>
        <filters>
            <field>Is_Digital_Sales__c</field>
            <operator>EqualTo</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <object>SalesOrder__c</object>
        <recordTriggerType>Update</recordTriggerType>
        <triggerType>RecordAfterSave</triggerType>
    </start>
    <status>Active</status>
    <textTemplates>
        <name>UnitReservingBody</name>
        <isViewedAsPlainText>true</isViewedAsPlainText>
        <text>Greetings from the Aldar Sales Team!
Thank you for reserving the Unit {!$Record.UnitNumber__c} with us! We are thrilled to have you on board and excited to help you take the next steps toward owning your new home.
1.      Document Verification and Processing
2.      Pay Down Payment
3.      Sign Your Sales Purchase Agreement (SPA)
Best regards,
The Aldar Sales Team</text>
    </textTemplates>
    <textTemplates>
        <name>UnitReservingBodyArabic</name>
        <isViewedAsPlainText>true</isViewedAsPlainText>
        <text>تحياتنا من فريق مبيعات الدار!
شكرًا لحجزكم الوحدة {!$Record.UnitNumber__c} معنا! نحن متحمسون لانضمامكم إلينا ونتطلع إلى مساعدتكم في اتخاذ الخطوات التالية نحو امتلاك منزلكم الجديد.
   1.    التحقق من المستندات ومعالجتها
   2.    دفع العربون
   3.    توقيع اتفاقية البيع والشراء (SPA)
مع أطيب التحيات،
فريق مبيعات الدار</text>
    </textTemplates>
    <textTemplates>
        <name>UnitReservingTitle</name>
        <isViewedAsPlainText>true</isViewedAsPlainText>
        <text>Unit reservation has been completed.</text>
    </textTemplates>
</Flow>
