<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <apiVersion>59.0</apiVersion>
    <areMetricsLoggedToDataCloud>false</areMetricsLoggedToDataCloud>
    <assignments>
        <name>Add_to_JSON</name>
        <label>Add to JSON</label>
        <locationX>138</locationX>
        <locationY>890</locationY>
        <assignmentItems>
            <assignToReference>MetadataList</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>finalMetadataName</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Metadata_Iteration</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Set_Branch</name>
        <label>Set Branch</label>
        <locationX>50</locationX>
        <locationY>458</locationY>
        <assignmentItems>
            <assignToReference>branch</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>feature/{!UserStoryRecord.Name}</stringValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Get_User_Story_Metadata</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>SetTempMetadataAPIName</name>
        <label>SetTempMetadataAPIName</label>
        <locationX>138</locationX>
        <locationY>782</locationY>
        <assignmentItems>
            <assignToReference>tempApiName</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Metadata_Iteration.copado__Metadata_API_Name__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>tempMetadataType</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Metadata_Iteration.copado__Type__c</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Add_to_JSON</targetReference>
        </connector>
    </assignments>
    <decisions>
        <name>Check_Scan_Type</name>
        <label>Check Scan Type</label>
        <locationX>314</locationX>
        <locationY>242</locationY>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>User_Story</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>scanType</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>User_Story</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>UserStoryRecord</targetReference>
            </connector>
            <label>User Story</label>
        </rules>
        <rules>
            <name>Credential</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>scanType</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Org</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>CredentialRecord</targetReference>
            </connector>
            <label>Credential</label>
        </rules>
    </decisions>
    <environments>Default</environments>
    <formulas>
        <name>finalApiName</name>
        <dataType>String</dataType>
        <expression>SUBSTITUTE({!tempApiName}, {!tempMetadataType}+&quot;.&quot;, &quot;&quot;)</expression>
    </formulas>
    <formulas>
        <name>finalMetadataName</name>
        <dataType>String</dataType>
        <expression>IF(
{!tempMetadataType}==&quot;ApexClass&quot;, 
&apos;classes/&apos;+{!finalApiName}+&apos;.cls;&apos;, 
	(IF({!tempMetadataType}==&quot;ApexTrigger&quot;, 
		&apos;triggers/&apos;+{!finalApiName}+&apos;.trigger;&apos;, 
			(IF({!tempMetadataType}==&quot;ApexPage&quot;, 
				&apos;pages/&apos;+{!finalApiName}+&apos;.page;&apos;,
					(IF({!tempMetadataType}==&quot;AuraDefinitionBundle&quot;, 
						&apos;aura/&apos;+{!finalApiName}+&apos;/*;&apos;,
							(IF({!tempMetadataType}==&quot;LightningComponentBundle&quot;, 
								&apos;lwc/&apos;+{!finalApiName}+&apos;/*;&apos;,
								&apos;fileNotSupported&gt;&gt;&gt;&apos;+{!finalApiName}+&apos;;&apos;
								)
							)
						)
					)
				)
			)
		)
	)
)</expression>
    </formulas>
    <formulas>
        <name>RedirectLink</name>
        <dataType>String</dataType>
        <expression>LEFT({!$Api.Partner_Server_URL_260}, FIND( &apos;/services&apos;, {!$Api.Partner_Server_URL_260})) &amp; {!Execute_Veracode_Job_Template.result}</expression>
    </formulas>
    <formulas>
        <name>relatedToKeyPrefix</name>
        <dataType>String</dataType>
        <expression>LEFT({!recordId},3)</expression>
    </formulas>
    <interviewLabel>Veracode Start Scan {!$Flow.CurrentDateTime}</interviewLabel>
    <label>Veracode Start Scan</label>
    <loops>
        <name>Metadata_Iteration</name>
        <label>Metadata Iteration</label>
        <locationX>50</locationX>
        <locationY>674</locationY>
        <collectionReference>Get_User_Story_Metadata</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>SetTempMetadataAPIName</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Get_Pipeline_Record</targetReference>
        </noMoreValuesConnector>
    </loops>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>AUTO_LAYOUT_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>Flow</processType>
    <recordLookups>
        <name>CredentialRecord</name>
        <label>CredentialRecord</label>
        <locationX>314</locationX>
        <locationY>350</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Get_Pipeline_Connection</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>recordId</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>copado__Org__c</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>Get_Pipeline_Connection</name>
        <label>Get Pipeline Connection</label>
        <locationX>314</locationX>
        <locationY>458</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Set_Credential_Branch</targetReference>
        </connector>
        <filterLogic>or</filterLogic>
        <filters>
            <field>copado__Destination_Environment__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>CredentialRecord.copado__Environment__c</elementReference>
            </value>
        </filters>
        <filters>
            <field>copado__Source_Environment__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>CredentialRecord.copado__Environment__c</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>copado__Deployment_Flow_Step__c</object>
        <queriedFields>Id</queriedFields>
        <queriedFields>copado__Deployment_Flow__c</queriedFields>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>Get_Pipeline_Record</name>
        <label>Get Pipeline Record</label>
        <locationX>314</locationX>
        <locationY>1166</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Veracode_Static_Code_Analysis</targetReference>
        </connector>
        <filterLogic>or</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>UserStoryRecord.copado__Project__r.copado__Deployment_Flow__c</elementReference>
            </value>
        </filters>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>Get_Pipeline_Connection.copado__Deployment_Flow__c</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>copado__Deployment_Flow__c</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>Get_User_Story_Metadata</name>
        <label>Get User Story Metadata</label>
        <locationX>50</locationX>
        <locationY>566</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Metadata_Iteration</targetReference>
        </connector>
        <filterLogic>1 AND (2 OR 3 OR 4 OR 5 OR 6 )</filterLogic>
        <filters>
            <field>copado__User_Story__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>UserStoryRecord.Id</elementReference>
            </value>
        </filters>
        <filters>
            <field>copado__Type__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>ApexClass</stringValue>
            </value>
        </filters>
        <filters>
            <field>copado__Type__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>ApexTrigger</stringValue>
            </value>
        </filters>
        <filters>
            <field>copado__Type__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>ApexPage</stringValue>
            </value>
        </filters>
        <filters>
            <field>copado__Type__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>AuraDefinitionBundle</stringValue>
            </value>
        </filters>
        <filters>
            <field>copado__Type__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>LightningComponentBundle</stringValue>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>copado__User_Story_Metadata__c</object>
        <queriedFields>Id</queriedFields>
        <queriedFields>copado__Metadata_API_Name__c</queriedFields>
        <queriedFields>copado__Type__c</queriedFields>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>GetEntityDefinition</name>
        <label>GetEntityDefinition</label>
        <locationX>314</locationX>
        <locationY>134</locationY>
        <assignNullValuesIfNoRecordsFound>true</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Check_Scan_Type</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>KeyPrefix</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>relatedToKeyPrefix</elementReference>
            </value>
        </filters>
        <object>EntityDefinition</object>
        <outputAssignments>
            <assignToReference>scanType</assignToReference>
            <field>DeveloperName</field>
        </outputAssignments>
    </recordLookups>
    <recordLookups>
        <name>Set_Credential_Branch</name>
        <label>Set Credential Branch</label>
        <locationX>314</locationX>
        <locationY>566</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Get_Pipeline_Record</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>copado__Org__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>recordId</elementReference>
            </value>
        </filters>
        <object>copado__Git_Backup__c</object>
        <outputAssignments>
            <assignToReference>branch</assignToReference>
            <field>copado__Branch__c</field>
        </outputAssignments>
    </recordLookups>
    <recordLookups>
        <name>UserStoryRecord</name>
        <label>UserStoryRecord</label>
        <locationX>50</locationX>
        <locationY>350</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Set_Branch</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>recordId</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>copado__User_Story__c</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <screens>
        <name>Veracode_Job_Started_Successfuly</name>
        <label>Veracode Job Started Successfuly</label>
        <locationX>314</locationX>
        <locationY>1490</locationY>
        <allowBack>false</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>false</allowPause>
        <fields>
            <name>DisplayText_ResultPage</name>
            <fieldText>&lt;p&gt;Execution Started &lt;a href=&quot;{!RedirectLink}&quot; rel=&quot;noopener noreferrer&quot; target=&quot;_blank&quot;&gt;Click Here&lt;/a&gt;&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
            <styleProperties>
                <verticalAlignment>
                    <stringValue>top</stringValue>
                </verticalAlignment>
                <width>
                    <stringValue>12</stringValue>
                </width>
            </styleProperties>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>true</showHeader>
    </screens>
    <screens>
        <name>Veracode_Static_Code_Analysis</name>
        <label>Veracode Static Code Analysis</label>
        <locationX>314</locationX>
        <locationY>1274</locationY>
        <allowBack>true</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>false</allowPause>
        <connector>
            <targetReference>Execute_Veracode_Job_Template</targetReference>
        </connector>
        <fields>
            <name>Credential_Text</name>
            <fieldText>&lt;p&gt;Execute Scan for Credential: {!CredentialRecord.Name}&lt;/p&gt;&lt;p&gt;Branch: {!branch}&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
            <styleProperties>
                <verticalAlignment>
                    <stringValue>top</stringValue>
                </verticalAlignment>
                <width>
                    <stringValue>12</stringValue>
                </width>
            </styleProperties>
            <visibilityRule>
                <conditionLogic>and</conditionLogic>
                <conditions>
                    <leftValueReference>CredentialRecord.Id</leftValueReference>
                    <operator>NotEqualTo</operator>
                    <rightValue>
                        <stringValue></stringValue>
                    </rightValue>
                </conditions>
            </visibilityRule>
        </fields>
        <fields>
            <name>User_Story_Text</name>
            <fieldText>&lt;p&gt;Execute Scan for: {!UserStoryRecord.Name}&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;background-color: rgb(255, 255, 255); color: rgb(68, 68, 68);&quot;&gt;Branch: {!branch}&lt;/span&gt;&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
            <styleProperties>
                <verticalAlignment>
                    <stringValue>top</stringValue>
                </verticalAlignment>
                <width>
                    <stringValue>12</stringValue>
                </width>
            </styleProperties>
            <visibilityRule>
                <conditionLogic>and</conditionLogic>
                <conditions>
                    <leftValueReference>UserStoryRecord.Id</leftValueReference>
                    <operator>NotEqualTo</operator>
                    <rightValue>
                        <stringValue></stringValue>
                    </rightValue>
                </conditions>
            </visibilityRule>
        </fields>
        <nextOrFinishButtonLabel>Execute</nextOrFinishButtonLabel>
        <showFooter>true</showFooter>
        <showHeader>true</showHeader>
    </screens>
    <start>
        <locationX>188</locationX>
        <locationY>0</locationY>
        <connector>
            <targetReference>GetEntityDefinition</targetReference>
        </connector>
    </start>
    <status>Active</status>
    <subflows>
        <name>Execute_Veracode_Job_Template</name>
        <label>Execute Veracode Job Template</label>
        <locationX>314</locationX>
        <locationY>1382</locationY>
        <connector>
            <targetReference>Veracode_Job_Started_Successfuly</targetReference>
        </connector>
        <flowName>Veracode_Execute_JobTemplate</flowName>
        <inputAssignments>
            <name>branch</name>
            <value>
                <elementReference>branch</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>copadoVersion</name>
            <value>
                <elementReference>Get_Pipeline_Record.copado__Platform__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>destinationId</name>
            <value>
                <elementReference>Get_Pipeline_Record.copado__Static_Code_Analysis_Settings__r.Copado_Environment__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>metadataList</name>
            <value>
                <elementReference>MetadataList</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>parentId</name>
            <value>
                <elementReference>recordId</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>pipelineId</name>
            <value>
                <elementReference>Get_Pipeline_Record.Id</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>scanType</name>
            <value>
                <elementReference>scanType</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>templateName</name>
            <value>
                <elementReference>Get_Pipeline_Record.copado__Static_Code_Analysis_Settings__r.Job_Template__r.copado__ApiName__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>timeout</name>
            <value>
                <elementReference>Get_Pipeline_Record.copado__Static_Code_Analysis_Settings__r.Veracode_Scan_Timeout__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>veracodeApplicationId</name>
            <value>
                <elementReference>Get_Pipeline_Record.copado__Static_Code_Analysis_Settings__r.Veracode_Application_ID__c</elementReference>
            </value>
        </inputAssignments>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </subflows>
    <variables>
        <name>branch</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>MetadataList</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>recordId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>scanType</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>tempApiName</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>tempMetadataType</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
</Flow>
