<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <actionCalls>
        <name>Email_Notification_on_31st_day</name>
        <label>Email Notification on 31st day</label>
        <locationX>1106</locationX>
        <locationY>984</locationY>
        <actionName>emailSimple</actionName>
        <actionType>emailSimple</actionType>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>emailAddresses</name>
            <value>
                <elementReference>$Record.SalesManager__r.Email</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>senderType</name>
            <value>
                <stringValue>OrgWideEmailAddress</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>senderAddress</name>
            <value>
                <stringValue>noreply@aldar.com</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>emailSubject</name>
            <value>
                <elementReference>Subject_for_31st_day</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>emailBody</name>
            <value>
                <elementReference>Email_notification_body_for_31stday</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>sendRichBody</name>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>ccRecipientAddressList</name>
            <value>
                <elementReference>Email_Cc_Broker_Formula</elementReference>
            </value>
        </inputParameters>
        <nameSegment>emailSimple</nameSegment>
        <offset>0</offset>
    </actionCalls>
    <actionCalls>
        <name>Email_Notification_on_Extended_cancellation_Date</name>
        <label>Email Notification on Extended cancellation Date</label>
        <locationX>1634</locationX>
        <locationY>984</locationY>
        <actionName>emailSimple</actionName>
        <actionType>emailSimple</actionType>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>emailAddresses</name>
            <value>
                <elementReference>$Record.SalesManager__r.Email</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>senderType</name>
            <value>
                <stringValue>OrgWideEmailAddress</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>senderAddress</name>
            <value>
                <stringValue>noreply@aldar.com</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>emailSubject</name>
            <value>
                <elementReference>Subject_for_31st_day</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>emailBody</name>
            <value>
                <elementReference>Email_notification_body_for_31stday</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>sendRichBody</name>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>ccRecipientAddressList</name>
            <value>
                <elementReference>Email_Cc_Broker_Formula</elementReference>
            </value>
        </inputParameters>
        <nameSegment>emailSimple</nameSegment>
        <offset>0</offset>
    </actionCalls>
    <actionCalls>
        <name>send_email_to_SM_and_LM_after_25_days</name>
        <label>send email to SM and LM after 25 days</label>
        <locationX>578</locationX>
        <locationY>876</locationY>
        <actionName>emailSimple</actionName>
        <actionType>emailSimple</actionType>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>emailAddresses</name>
            <value>
                <elementReference>$Record.SalesManager__r.Email</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>senderType</name>
            <value>
                <stringValue>OrgWideEmailAddress</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>senderAddress</name>
            <value>
                <stringValue>noreply@aldar.com</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>emailSubject</name>
            <value>
                <elementReference>Subject_for_Email</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>emailBody</name>
            <value>
                <elementReference>SMEmailNotificationbody</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>sendRichBody</name>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>ccRecipientAddressList</name>
            <value>
                <elementReference>Email_Cc_Broker_Formula</elementReference>
            </value>
        </inputParameters>
        <nameSegment>emailSimple</nameSegment>
        <offset>0</offset>
    </actionCalls>
    <actionCalls>
        <name>send_email_to_SM_and_LM_after_28_days</name>
        <label>send email to SM and LM after 28 days</label>
        <locationX>842</locationX>
        <locationY>876</locationY>
        <actionName>emailSimple</actionName>
        <actionType>emailSimple</actionType>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>emailAddresses</name>
            <value>
                <elementReference>$Record.SalesManager__r.Email</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>senderType</name>
            <value>
                <stringValue>OrgWideEmailAddress</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>senderAddress</name>
            <value>
                <stringValue>noreply@aldar.com</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>emailSubject</name>
            <value>
                <stringValue>HIGH ALERT!! UNIT WILL BE AUTO-CANCELLED </stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>emailBody</name>
            <value>
                <elementReference>SMEmailBodyFor28Day</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>sendRichBody</name>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>ccRecipientAddressList</name>
            <value>
                <elementReference>Email_Cc_Broker_Formula</elementReference>
            </value>
        </inputParameters>
        <nameSegment>emailSimple</nameSegment>
        <offset>0</offset>
    </actionCalls>
    <actionCalls>
        <name>send_email_to_SM_and_LM_Before_Two_days_of_Cancellation</name>
        <label>send email to SM and LM Before Two days of Cancellation</label>
        <locationX>1370</locationX>
        <locationY>876</locationY>
        <actionName>emailSimple</actionName>
        <actionType>emailSimple</actionType>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>emailAddresses</name>
            <value>
                <elementReference>$Record.SalesManager__r.Email</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>senderType</name>
            <value>
                <stringValue>OrgWideEmailAddress</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>senderAddress</name>
            <value>
                <stringValue>noreply@aldar.com</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>emailSubject</name>
            <value>
                <stringValue>HIGH ALERT!! UNIT WILL BE AUTO-CANCELLED </stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>emailBody</name>
            <value>
                <elementReference>SMEmailBodyFor28Day</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>sendRichBody</name>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>ccRecipientAddressList</name>
            <value>
                <elementReference>Email_Cc_Broker_Formula</elementReference>
            </value>
        </inputParameters>
        <nameSegment>emailSimple</nameSegment>
        <offset>0</offset>
    </actionCalls>
    <actionCalls>
        <name>Send_Email_to_SM_for_status_pending</name>
        <label>Send Email to SM for status pending</label>
        <locationX>50</locationX>
        <locationY>876</locationY>
        <actionName>emailSimple</actionName>
        <actionType>emailSimple</actionType>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>emailAddresses</name>
            <value>
                <elementReference>$Record.SalesManager__r.Email</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>senderType</name>
            <value>
                <stringValue>OrgWideEmailAddress</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>senderAddress</name>
            <value>
                <stringValue>noreply@aldar.com</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>emailSubject</name>
            <value>
                <elementReference>Subject_for_Email</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>emailBody</name>
            <value>
                <elementReference>SMEmailNotificationbody</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>sendRichBody</name>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>ccRecipientAddressList</name>
            <value>
                <elementReference>Email_Cc_Broker_Formula</elementReference>
            </value>
        </inputParameters>
        <nameSegment>emailSimple</nameSegment>
        <offset>0</offset>
    </actionCalls>
    <actionCalls>
        <name>Send_Email_to_SM_for_status_pending_for_15days</name>
        <label>Send Email to SM for status pending for 15days</label>
        <locationX>314</locationX>
        <locationY>876</locationY>
        <actionName>emailSimple</actionName>
        <actionType>emailSimple</actionType>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>emailAddresses</name>
            <value>
                <elementReference>$Record.SalesManager__r.Email</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>senderType</name>
            <value>
                <stringValue>OrgWideEmailAddress</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>senderAddress</name>
            <value>
                <stringValue>noreply@aldar.com</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>emailSubject</name>
            <value>
                <elementReference>Subject_for_Email</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>emailBody</name>
            <value>
                <elementReference>SMEmailNotificationbody</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>sendRichBody</name>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>ccRecipientAddressList</name>
            <value>
                <elementReference>Email_Cc_Broker_Formula</elementReference>
            </value>
        </inputParameters>
        <nameSegment>emailSimple</nameSegment>
        <offset>0</offset>
    </actionCalls>
    <apiVersion>62.0</apiVersion>
    <areMetricsLoggedToDataCloud>false</areMetricsLoggedToDataCloud>
    <assignments>
        <name>Assignment_1</name>
        <label>Assignment 1</label>
        <locationX>1062</locationX>
        <locationY>468</locationY>
        <assignmentItems>
            <assignToReference>Total_outstanding_amount</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>OutstandingAmount</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>TotalReceivedAmount</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>ReceivedAmount</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Total_Downpayment_Amount_as_of_today</targetReference>
        </connector>
    </assignments>
    <decisions>
        <name>Check_Date_conditions</name>
        <label>Check Date conditions</label>
        <locationX>974</locationX>
        <locationY>768</locationY>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>X48_hours_notifications</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.BookingDate__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <elementReference>lasttwodays</elementReference>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.SubStatus__c</leftValueReference>
                <operator>NotEqualTo</operator>
                <rightValue>
                    <stringValue>Pending for Finance Clearance</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Send_Email_to_SM_for_status_pending</targetReference>
            </connector>
            <label>48 hours notifications</label>
        </rules>
        <rules>
            <name>X15_Days_Notification</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.BookingDate__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <elementReference>fifteendays</elementReference>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.SubStatus__c</leftValueReference>
                <operator>NotEqualTo</operator>
                <rightValue>
                    <stringValue>Pending for Finance Clearance</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Send_Email_to_SM_for_status_pending_for_15days</targetReference>
            </connector>
            <label>15 Days Notification</label>
        </rules>
        <rules>
            <name>X25_Days_Notification</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.BookingDate__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <elementReference>twentyFifthDay</elementReference>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.SubStatus__c</leftValueReference>
                <operator>NotEqualTo</operator>
                <rightValue>
                    <stringValue>Pending for Finance Clearance</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>send_email_to_SM_and_LM_after_25_days</targetReference>
            </connector>
            <label>25 Days Notification</label>
        </rules>
        <rules>
            <name>X28_Days_Notification</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.BookingDate__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <elementReference>twentyEightDays</elementReference>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.Extended_Cancellation_Date__c</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.SubStatus__c</leftValueReference>
                <operator>NotEqualTo</operator>
                <rightValue>
                    <stringValue>Pending for Finance Clearance</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>send_email_to_SM_and_LM_after_28_days</targetReference>
            </connector>
            <label>28 Days Notification</label>
        </rules>
        <rules>
            <name>Sales_Order_cancellation_Day</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.BookingDate__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <elementReference>ThirtyFirstDay</elementReference>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.Extended_Cancellation_Date__c</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.SubStatus__c</leftValueReference>
                <operator>NotEqualTo</operator>
                <rightValue>
                    <stringValue>Pending for Finance Clearance</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Salesorder_cancellation_on_31_day</targetReference>
            </connector>
            <label>Sales Order cancellation Day</label>
        </rules>
        <rules>
            <name>Two_days_before_notification_for_extended_salesorder_canc</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Extended_Cancellation_Date__c</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.Extended_Cancellation_Date__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <elementReference>TwodaysBeforeExtendedsalesordercancellation</elementReference>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.SubStatus__c</leftValueReference>
                <operator>NotEqualTo</operator>
                <rightValue>
                    <stringValue>Pending for Finance Clearance</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>send_email_to_SM_and_LM_Before_Two_days_of_Cancellation</targetReference>
            </connector>
            <label>Two days before notification for extended salesorder canc</label>
        </rules>
        <rules>
            <name>salesorder_cancellation_date_for_extension_date</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Extended_Cancellation_Date__c</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.Extended_Cancellation_Date__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <elementReference>Today</elementReference>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.SubStatus__c</leftValueReference>
                <operator>NotEqualTo</operator>
                <rightValue>
                    <stringValue>Pending for Finance Clearance</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Salesorder_cancellation_on_extended_cancellation_date</targetReference>
            </connector>
            <label>salesorder cancellation date for extension date</label>
        </rules>
    </decisions>
    <decisions>
        <name>Exempted_Project_Name_check</name>
        <label>Exempted Project Name check</label>
        <locationX>974</locationX>
        <locationY>660</locationY>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Exempted_Project_Names_exists</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Unit__r.Project__r.Skip_Auto_Cancellation_Notifications__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <label>Exempted Project Names exists</label>
        </rules>
        <rules>
            <name>Downpayment_Check</name>
            <conditionLogic>or</conditionLogic>
            <conditions>
                <leftValueReference>$Record.CustomerSPASigned__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>DLDAmountStatus</leftValueReference>
                <operator>LessThan</operator>
                <rightValue>
                    <numberValue>0.0</numberValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>TotalReceivedAmount</leftValueReference>
                <operator>GreaterThan</operator>
                <rightValue>
                    <numberValue>0.0</numberValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.ComplianceStatus__c</leftValueReference>
                <operator>NotEqualTo</operator>
                <rightValue>
                    <stringValue>Cleared</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Check_Date_conditions</targetReference>
            </connector>
            <label>Downpayment Check</label>
        </rules>
    </decisions>
    <description>added sub status does not eq to pending for finance clearance</description>
    <environments>Default</environments>
    <formulas>
        <name>AED_Convert</name>
        <dataType>String</dataType>
        <expression>&quot;AED &quot; &amp; TEXT({!TotalReceivedAmount})</expression>
    </formulas>
    <formulas>
        <name>DLDAmountStatus</name>
        <dataType>Number</dataType>
        <expression>{!$Record.ADMFeeReceived__c} - ({!$Record.ADMFeeStatus__c} - {!$Record.ADM_Admin_Fee__c})</expression>
        <scale>2</scale>
    </formulas>
    <formulas>
        <name>Down_Payment_message</name>
        <dataType>String</dataType>
        <expression>{!IF($Record.DownPaymentStatus__c &gt; 0, &quot;100% Down Payment receipt is not entered. &quot;, &quot;&quot;)}</expression>
    </formulas>
    <formulas>
        <name>Email_Cc_Broker_Formula</name>
        <dataType>String</dataType>
        <expression>IF(
  ISBLANK({!$Record.Opportunity__r.BrokerAgencyAccount__r.Email__c}) &amp;&amp; ISBLANK({!$Record.AgentEmail__c}),
  {!$Record.SalesManager__r.Manager.Email},
  IF(
    ISBLANK({!$Record.Opportunity__r.BrokerAgencyAccount__r.Email__c}),
    IF(
      ISBLANK({!$Record.AgentEmail__c}),
      {!$Record.SalesManager__r.Manager.Email},
      {!$Record.AgentEmail__c} &amp; &quot;,&quot; &amp; {!$Record.SalesManager__r.Manager.Email}
    ),
    IF(
      ISBLANK({!$Record.AgentEmail__c}),
      {!$Record.Opportunity__r.BrokerAgencyAccount__r.Email__c} &amp; &quot;,&quot; &amp; {!$Record.SalesManager__r.Manager.Email},
      {!$Record.Opportunity__r.BrokerAgencyAccount__r.Email__c} &amp; &quot;,&quot; &amp; {!$Record.AgentEmail__c} &amp; &quot;,&quot; &amp; {!$Record.SalesManager__r.Manager.Email}
    )
  )
)</expression>
    </formulas>
    <formulas>
        <name>EmailSubject</name>
        <dataType>String</dataType>
        <expression>&quot;Pending Sales Order: &quot; &amp; {!$Record.Name}</expression>
    </formulas>
    <formulas>
        <name>fifteendays</name>
        <dataType>Date</dataType>
        <expression>Today() - 15</expression>
    </formulas>
    <formulas>
        <name>FinalPendingAmount</name>
        <dataType>Currency</dataType>
        <expression>{!Total_outstanding_amount} - {!TotalReceivedAmount}</expression>
        <scale>2</scale>
    </formulas>
    <formulas>
        <name>Formula_for_total_amount</name>
        <dataType>Currency</dataType>
        <expression>{!OutstandingAmount}+{!Formula_for_total_amount}</expression>
        <scale>2</scale>
    </formulas>
    <formulas>
        <name>last3days</name>
        <dataType>Date</dataType>
        <expression>TODAY()-3</expression>
    </formulas>
    <formulas>
        <name>lasttwodays</name>
        <dataType>Date</dataType>
        <expression>TODAY() - 2</expression>
    </formulas>
    <formulas>
        <name>Muncipality_receipt_notEntered_message</name>
        <dataType>String</dataType>
        <expression>{!IF($Record.IsOtherChargesChange__c = TRUE, &quot;100% Municipality Receipt is not entered.&quot;, &quot;&quot;)}</expression>
    </formulas>
    <formulas>
        <name>Municipality_Fee_Status</name>
        <dataType>String</dataType>
        <expression>IF(
    ({!$Record.ADMFeeStatus__c} =0),
    &quot;&lt;span style=&apos;color: black;&apos;&gt;Received&lt;/span&gt;&quot;,
    &quot;&lt;span style=&apos;color: red;&apos;&gt;Not Received&lt;/span&gt;&quot;
)</expression>
    </formulas>
    <formulas>
        <name>Now</name>
        <dataType>Date</dataType>
        <expression>NOW()</expression>
    </formulas>
    <formulas>
        <name>Outstanding_amount_formula</name>
        <dataType>Currency</dataType>
        <expression>{!Total_Downpayment_Amount_as_of_today.OutstandingAmount__c}</expression>
        <scale>2</scale>
    </formulas>
    <formulas>
        <name>OutstandingAmount</name>
        <dataType>Currency</dataType>
        <expression>{!Total_Downpayment_Amount_as_of_today.OutstandingAmount__c}</expression>
        <scale>2</scale>
    </formulas>
    <formulas>
        <name>ReceivedAmount</name>
        <dataType>Currency</dataType>
        <expression>{!Total_Downpayment_Amount_as_of_today.OutstandingAmountToReceive__c}</expression>
        <scale>2</scale>
    </formulas>
    <formulas>
        <name>SPA_NotSigned_Message</name>
        <dataType>String</dataType>
        <expression>{!IF(NOT($Record.CustomerSPASigned__c), &quot;Customer SPA is not signed.&quot;, &quot;&quot;)}</expression>
    </formulas>
    <formulas>
        <name>SPA_Signed_Text</name>
        <dataType>String</dataType>
        <expression>IF(
    {!$Record.CustomerSPASigned__c},
    &quot;&lt;span style=&apos;color: black;&apos;&gt;Yes&lt;/span&gt;&quot;, 
    &quot;&lt;span style=&apos;color: red;&apos;&gt;No&lt;/span&gt;&quot;
)</expression>
    </formulas>
    <formulas>
        <name>ThirtyFirstDay</name>
        <dataType>Date</dataType>
        <expression>Today() - 31</expression>
    </formulas>
    <formulas>
        <name>Today</name>
        <dataType>Date</dataType>
        <expression>TODAY()</expression>
    </formulas>
    <formulas>
        <name>Total_Outstanding_Amount_Email</name>
        <dataType>String</dataType>
        <expression>IF(
    ({!TotalReceivedAmount} =0),
    &quot;&lt;span style=&apos;color: black;&apos;&gt;Received&lt;/span&gt;&quot;,
    &quot;&lt;span style=&apos;color: red;&apos;&gt;Not Received&lt;/span&gt;&quot;
)</expression>
    </formulas>
    <formulas>
        <name>twentyEightDays</name>
        <dataType>Date</dataType>
        <expression>Today() - 28</expression>
    </formulas>
    <formulas>
        <name>twentyFifthDay</name>
        <dataType>Date</dataType>
        <expression>Today() - 25</expression>
    </formulas>
    <formulas>
        <name>TwodaysBeforeExtendedsalesordercancellation</name>
        <dataType>Date</dataType>
        <expression>TODAY()+ 2</expression>
    </formulas>
    <interviewLabel>Pending Sales Order email notification for 48 days and 72 hours {!$Flow.CurrentDateTime}</interviewLabel>
    <label>Pending Sales Order email notification for 48 days and 72 hours</label>
    <loops>
        <name>Total_Downpayment_Amount_as_of_today</name>
        <label>Total Downpayment Amount as of today</label>
        <locationX>974</locationX>
        <locationY>360</locationY>
        <collectionReference>Get_Records_1</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Assignment_1</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Exempted_Project_Name_check</targetReference>
        </noMoreValuesConnector>
    </loops>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>AUTO_LAYOUT_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>AutoLaunchedFlow</processType>
    <recordCreates>
        <name>Salesorder_cancellation_on_31_day</name>
        <label>Salesorder cancellation on 31 day</label>
        <locationX>1106</locationX>
        <locationY>876</locationY>
        <connector>
            <targetReference>Email_Notification_on_31st_day</targetReference>
        </connector>
        <inputAssignments>
            <field>CancellationRequestDate__c</field>
            <value>
                <elementReference>Today</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Cancellation_Status__c</field>
            <value>
                <stringValue>Approved</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>DownPaymentStatus__c</field>
            <value>
                <elementReference>$Record.DownPaymentStatus__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>ExistingPromoOrOffer__c</field>
            <value>
                <elementReference>$Record.Offer__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>IsReservationCancellation__c</field>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>IsReservationCancellationfor2days__c</field>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>PaymentPlan__c</field>
            <value>
                <elementReference>$Record.PaymentPlan__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>ReasonforCancellation__c</field>
            <value>
                <stringValue>Auto Cancellation of Salesorder on 31 Day</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>SalesManager__c</field>
            <value>
                <elementReference>$Record.SalesManager__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>SalesOrder__c</field>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Unit__c</field>
            <value>
                <elementReference>$Record.Unit__c</elementReference>
            </value>
        </inputAssignments>
        <object>SalesOrderCancellation__c</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordCreates>
    <recordCreates>
        <name>Salesorder_cancellation_on_extended_cancellation_date</name>
        <label>Salesorder cancellation on extended cancellation date</label>
        <locationX>1634</locationX>
        <locationY>876</locationY>
        <connector>
            <targetReference>Email_Notification_on_Extended_cancellation_Date</targetReference>
        </connector>
        <inputAssignments>
            <field>CancellationRequestDate__c</field>
            <value>
                <elementReference>Today</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Cancellation_Status__c</field>
            <value>
                <stringValue>Approved</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>DownPaymentStatus__c</field>
            <value>
                <elementReference>$Record.DownPaymentStatus__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>ExistingPromoOrOffer__c</field>
            <value>
                <elementReference>$Record.Offer__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>IsReservationCancellation__c</field>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>IsReservationCancellationfor2days__c</field>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>PaymentPlan__c</field>
            <value>
                <elementReference>$Record.PaymentPlan__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>ReasonforCancellation__c</field>
            <value>
                <stringValue>Auto Cancellation of Salesorder on Extended Date</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>SalesManager__c</field>
            <value>
                <elementReference>$Record.SalesManager__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>SalesOrder__c</field>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Unit__c</field>
            <value>
                <elementReference>$Record.Unit__c</elementReference>
            </value>
        </inputAssignments>
        <object>SalesOrderCancellation__c</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordCreates>
    <recordLookups>
        <name>Get_Records_1</name>
        <label>Get Installment Line Records</label>
        <locationX>974</locationX>
        <locationY>252</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Total_Downpayment_Amount_as_of_today</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>SalesOrder__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </filters>
        <filters>
            <field>InstallmentDate__c</field>
            <operator>LessThanOrEqualTo</operator>
            <value>
                <elementReference>Today</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>InstallmentLines__c</object>
        <queriedFields>Id</queriedFields>
        <queriedFields>OutstandingAmount__c</queriedFields>
        <queriedFields>OutstandingAmountToReceive__c</queriedFields>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <start>
        <locationX>848</locationX>
        <locationY>0</locationY>
        <connector>
            <targetReference>Get_Records_1</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Status__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Pending</stringValue>
            </value>
        </filters>
        <filters>
            <field>SalesManager__c</field>
            <operator>IsNull</operator>
            <value>
                <booleanValue>false</booleanValue>
            </value>
        </filters>
        <object>SalesOrder__c</object>
        <schedule>
            <frequency>Daily</frequency>
            <startDate>2024-11-14</startDate>
            <startTime>09:00:00.000Z</startTime>
        </schedule>
        <triggerType>Scheduled</triggerType>
    </start>
    <status>Active</status>
    <textTemplates>
        <name>Email_notification_body_for_31stday</name>
        <isViewedAsPlainText>true</isViewedAsPlainText>
        <text>&lt;p&gt;Dear  &lt;strong&gt;{!$Record.SalesManagerName__c},&lt;/strong&gt;&lt;/p&gt;
    &lt;p&gt;This is to inform you that the unit#  {!$Record.Unit__r.Name} has been cancelled due to the below mentioned reasons.&lt;/p&gt;
    &lt;ol&gt;
         &lt;li&gt;&lt;strong&gt;Sales Order #:&lt;/strong&gt; {!$Record.Name}&lt;/li&gt;
        &lt;li&gt;&lt;strong&gt;Pending Sub Status:&lt;/strong&gt; {!$Record.SubStatus__c}&lt;/li&gt;
        &lt;li&gt;&lt;strong&gt;Customer (Primary Buyer) Name:&lt;/strong&gt; {!$Record.AccountName__c}&lt;/li&gt;
        &lt;li&gt;&lt;strong&gt;Ageing (in days):&lt;/strong&gt; {!$Record.DaysSinceBooking__c}&lt;/li&gt;
        &lt;li&gt;&lt;strong&gt;Resident Type:&lt;/strong&gt; {!$Record.ContactResidentStatus__c}&lt;/li&gt;
         &lt;li&gt;&lt;strong&gt;Onboarding Status:&lt;/strong&gt; {!$Record.ComplianceStatus__c}&lt;/li&gt;
        &lt;li&gt;&lt;strong&gt;SPA Signed:&lt;/strong&gt; {!SPA_Signed_Text}&lt;/li&gt;
        &lt;li&gt;&lt;strong&gt;Downpayment (DP)&lt;/strong&gt; –   {!AED_Convert} - {!Total_Outstanding_Amount_Email}&lt;br&gt; &lt;/li&gt; &lt;li&gt;&lt;strong&gt;Municipality Fees:&lt;/strong&gt;&lt;span style=&quot;color: {!IF($Record.ADMFeeStatus__c = 0, &apos;black&apos;, &apos;red&apos;)}&quot;&gt;
            {!$Record.ADMFeeStatus__c} - {!Municipality_Fee_Status}
        &lt;/span&gt;&lt;/li&gt;
    &lt;/ol&gt;

    &lt;p&gt;For any clarifications, please reach out to the respective Sales Admin or the Sales Support team.&lt;/p&gt;</text>
    </textTemplates>
    <textTemplates>
        <name>SMEmailBodyFor28Day</name>
        <isViewedAsPlainText>true</isViewedAsPlainText>
        <text>&lt;p&gt;Dear  &lt;strong&gt;{!$Record.SalesManagerName__c},&lt;/strong&gt;&lt;/p&gt;
    &lt;p style=&quot;background-color: rgb(255, 255, 0);&quot;&gt;&lt;strong&gt;Please be advised that the {!$Record.Unit__r.Name}  remains pending for the following reasons. We strongly encourage you to review the details below and address all pending items within the next 24 to 48 hours to prevent auto-cancellation.&lt;/strong&gt;&lt;/p&gt;
    &lt;ol&gt;
        &lt;li&gt;&lt;strong&gt;Sales Order #:&lt;/strong&gt; {!$Record.Name}&lt;/li&gt;
        &lt;li&gt;&lt;strong&gt;Pending Sub Status:&lt;/strong&gt; {!$Record.SubStatus__c}&lt;/li&gt;
        &lt;li&gt;&lt;strong&gt;Customer (Primary Buyer) Name:&lt;/strong&gt; {!$Record.AccountName__c}&lt;/li&gt;
        &lt;li&gt;&lt;strong&gt;Ageing (in days):&lt;/strong&gt; {!$Record.DaysSinceBooking__c}&lt;/li&gt;
         &lt;li&gt;&lt;strong&gt;Onboarding Status:&lt;/strong&gt; {!$Record.ComplianceStatus__c}&lt;/li&gt;
        &lt;li&gt;&lt;strong&gt;SPA Signed:&lt;/strong&gt; {!SPA_Signed_Text}&lt;/li&gt;
        &lt;li&gt;&lt;strong&gt;Downpayment (DP)&lt;/strong&gt; –  {!AED_Convert} - {!Total_Outstanding_Amount_Email}&lt;br&gt; &lt;/li&gt; &lt;li&gt;&lt;strong&gt;Municipality Fees:&lt;/strong&gt; {!$Record.ADMFeeStatus__c} - {!Municipality_Fee_Status}&lt;/li&gt;
    &lt;/ol&gt;

    &lt;p&gt;For any clarifications, please reach out to the respective Sales Admin or the Sales Support team.&lt;/p&gt;
    &lt;p&gt;#Say No to Pendings!! Happy Selling!!&lt;/p&gt;</text>
    </textTemplates>
    <textTemplates>
        <name>SMEmailNotificationbody</name>
        <isViewedAsPlainText>true</isViewedAsPlainText>
        <text>&lt;p&gt;Dear  &lt;strong&gt;{!$Record.SalesManagerName__c},&lt;/strong&gt;&lt;/p&gt;
    &lt;p&gt;This is a gentle reminder to complete all pending actions listed below for Sales Order &lt;strong&gt;{!$Record.Name}&lt;/strong&gt; to avoid the auto-cancellation of the unit. Please review the details and complete the necessary actions at the earliest.&lt;/p&gt;
    &lt;ol&gt;
        &lt;li&gt;&lt;strong&gt;Sales Order #:&lt;/strong&gt; {!$Record.Name}&lt;/li&gt;
        &lt;li&gt;&lt;strong&gt;Pending Sub Status:&lt;/strong&gt; {!$Record.SubStatus__c}&lt;/li&gt;
        &lt;li&gt;&lt;strong&gt;Customer (Primary Buyer) Name:&lt;/strong&gt; {!$Record.AccountName__c}&lt;/li&gt;
        &lt;li&gt;&lt;strong&gt;Ageing (in days):&lt;/strong&gt; {!$Record.DaysSinceBooking__c}&lt;/li&gt;
        &lt;li&gt;&lt;strong&gt;Resident Type:&lt;/strong&gt; {!$Record.ContactResidentStatus__c}&lt;/li&gt;
         &lt;li&gt;&lt;strong&gt;Onboarding Status:&lt;/strong&gt; {!$Record.ComplianceStatus__c}&lt;/li&gt;
        &lt;li&gt;&lt;strong&gt;SPA Signed:&lt;/strong&gt; {!SPA_Signed_Text}&lt;/li&gt;
        &lt;li&gt;&lt;strong&gt;Downpayment (DP)&lt;/strong&gt; –  {!AED_Convert} - {!Total_Outstanding_Amount_Email}&lt;br&gt; &lt;/li&gt; &lt;li&gt;&lt;strong&gt;Municipality Fees:&lt;/strong&gt;&lt;span style=&quot;color: {!IF($Record.ADMFeeStatus__c = 0, &apos;black&apos;, &apos;red&apos;)}&quot;&gt;
            {!$Record.ADMFeeStatus__c} - {!Municipality_Fee_Status}
        &lt;/span&gt;&lt;/li&gt;
    &lt;/ol&gt;

    &lt;p&gt;For any clarifications, please reach out to the respective Sales Admin or the Sales Support team.&lt;/p&gt;
    &lt;p&gt;#Say No to Pendings!! Happy Selling!!&lt;/p&gt;</text>
    </textTemplates>
    <textTemplates>
        <name>Subject_for_31st_day</name>
        <isViewedAsPlainText>true</isViewedAsPlainText>
        <text>Auto-Cancellation Notice of Unit# {!$Record.Unit__r.Name}</text>
    </textTemplates>
    <textTemplates>
        <name>Subject_for_Email</name>
        <isViewedAsPlainText>true</isViewedAsPlainText>
        <text>REMINDER!! Unit# {!$Record.Unit__r.Name}  SO# {!$Record.Name} PENDING STATUS﻿</text>
    </textTemplates>
    <textTemplates>
        <name>SubStatusValues</name>
        <isViewedAsPlainText>false</isViewedAsPlainText>
        <text>&lt;p&gt;Pending with Sales Manager, Printing Pending with Sales Admin, Digital SPA Verification with SalesAdmin&lt;/p&gt;</text>
    </textTemplates>
    <variables>
        <name>TodayDate</name>
        <dataType>Date</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <value>
            <elementReference>Today</elementReference>
        </value>
    </variables>
    <variables>
        <name>Total_outstanding_amount</name>
        <dataType>Currency</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>2</scale>
        <value>
            <numberValue>0.0</numberValue>
        </value>
    </variables>
    <variables>
        <name>TotalReceivedAmount</name>
        <dataType>Currency</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>2</scale>
        <value>
            <numberValue>0.0</numberValue>
        </value>
    </variables>
    <variables>
        <name>twodaysDate</name>
        <dataType>DateTime</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
</Flow>
