<!-- sldsValidatorIgnore -->
<template >
    <template if:true={openModal}>
    <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true" class="slds-modal slds-fade-in-open">
        <div class="slds-modal__container">
         <!-- Modal/Popup Box LWC header here -->
         <header class="slds-modal__header">
            <button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse"
                title="Close" onclick={closeModal}>
                <lightning-icon icon-name="utility:close" alternative-text="close" variant="inverse"
                    size="small"></lightning-icon>
                <span class="slds-assistive-text">Close</span>
            </button>
            <h2 id="modal-heading-01" class="slds-text-heading_medium slds-hyphenate">Receipt Acknowledgement Creation</h2>
        </header>
        <div class="slds-modal__content slds-p-around_medium" id="modal-content-id-1">
        <template if:true={parentRecord}>
            <template if:true={parentRecord.salesOrderRecord}>
                <div class="slds-grid slds-wrap">
                    <div class="slds-col slds-size_1-of-3">
                        <lightning-input  class="labelstyle" name="unitNumber" value={parentRecord.salesOrderRecord.UnitNumber__c} label="Unit Number" read-only="true"></lightning-input>
                    </div>
                    <!--SSR-269-->
					<template if:false={isSRRecord}>
                    <div class="slds-col slds-size_1-of-3">
                        <lightning-input  class="labelstyle" name="accountName" value={parentRecord.salesOrderRecord.AccountName__c} label="Account Name" read-only="true"></lightning-input>
                    </div>
					</template>
					<template if:true={isSRRecord}>
                    <div class="slds-col slds-size_1-of-3">
					<legend class="slds-form-element__legend slds-form-element__label">Account Name</legend>
                        <lightning-combobox name="accountName" value={selectedAccount} options={accountvalues} onchange={handleChangeAccountName} required></lightning-combobox>
                    </div>
					</template>
                    <div class="slds-col slds-size_1-of-3">
                        <lightning-input  class="labelstyle" name="salesOrderNumber" value={parentRecord.salesOrderRecord.Name} label="Sales Order Number" read-only="true"></lightning-input>
                    </div>
                    <template if:true={isSRRecord}>
                        <div class="slds-col slds-size_1-of-2">
						<legend class="slds-form-element__legend slds-form-element__label">Email</legend>
                            <lightning-input name="receiptEmail" value={email} disabled></lightning-input>
                        </div>
					</template>
                    <!--SSR-269-->
                </div>
            </template>
            <template if:true={parentRecord.installmentRec}>
                <template if:true={receiptFromSR}>
                    <div class="slds-grid slds-wrap" if:false={isUnidentified}>
                        <div class="slds-col slds-size_1-of-3">
                            <lightning-input  class="labelstyle" name="installmentNumber" value={parentRecord.installmentRec.InstallmentNumber__c} label="Installment Number" read-only="true"></lightning-input>
                        </div>
                        <div class="slds-col slds-size_1-of-3">
                            <lightning-input  class="labelstyle" name="installmentAmount" value={parentRecord.installmentRec.InstallmentAmount__c} label="Installment Amount" read-only="true"></lightning-input>
                        </div>
                        <div class="slds-col slds-size_1-of-3">
                            <lightning-input  class="labelstyle" name="pendingAmount" value={parentRecord.installmentRec.PendingAmount__c} label="Pending Amount" read-only="true"></lightning-input>
                        </div>
                    </div>
                </template>
            </template>
        </template>
                    <div class="slds-grid slds-wrap">
                        <div class="slds-col slds-size_1-of-2 slds-p-right_xx-small">
                            <legend class="slds-form-element__legend slds-form-element__label">Payment Mode</legend>
                                <lightning-combobox read-only={isUnidentified} name="PaymentMode" required value={paymentMode} onchange={handleChangePaymentMode} options={paymentModes}></lightning-combobox>
                        </div>
                        <template if:true={isPaymentTypeCheque}>
                            <div class="slds-col slds-size_1-of-2">
                                <legend class="slds-form-element__legend slds-form-element__label">Manager's Cheque</legend>
                                <lightning-input data-name="managerCheque" checked={managerCheque} type="checkbox" onchange={handleChange}></lightning-input>
                            </div>
                        </template>
                        <div class="slds-col slds-size_1-of-2">
                            <legend class="slds-form-element__legend slds-form-element__label">Cheque/CC/Wire Transfer #</legend>
                            <lightning-input disabled={disableForCrypto} data-name="referenceNumber" value={referenceNumber} required onchange={handleChange}></lightning-input>
                        </div>
                        <div class="slds-col slds-size_1-of-2">
                            <template if:false={isUnidentified}>
                                <legend class="slds-form-element__legend slds-form-element__label">Mortgage Cheque</legend><lightning-input disabled={disableForCrypto} data-name="mortgageCheque" value={mortgageCheque} type="checkbox" onchange={handleChange}></lightning-input>
                            </template>
                        </div>
                        <div class="slds-col slds-size_1-of-2" if:true={isUnidentified}>
                            <legend class="slds-form-element__legend slds-form-element__label">GL Date</legend>
                            <lightning-input disabled={disableForCrypto} data-name="glDate" value={glDate} type="date" min="0" required="true" onchange={handleChange}></lightning-input> 
                        </div>
                        <div class="slds-col slds-size_1-of-2">
                            <legend class="slds-form-element__legend slds-form-element__label">Maturity/Cheque Date</legend>
                            <lightning-input disabled={disableForCrypto} data-name="maturityDate" value={maturityDate} type="date" min="0" required={maturityDateRequired} onchange={handleChange}></lightning-input> 
                        </div>
                        
                        <div class="slds-col slds-size_1-of-2 slds-p-right_xx-small">
                            <template if:true={currency.data}>
                                <legend class="slds-form-element__legend slds-form-element__label">Currency</legend>
                                <lightning-combobox name="Currency" required value={currencyISO}  onchange={handleChangeCurrency} options={currency.data.values}></lightning-combobox>
                            </template>
                        </div>
                        <div class="slds-col slds-size_1-of-2">
                            <legend class="slds-form-element__legend slds-form-element__label">Amount</legend>
                            <!-- FIN-75: Sai Kumar - Bulk Installment Allocation changes -->
                            <lightning-input data-name="amount" value={amount} required onchange={handleChange} disabled={isAmountDisabled}></lightning-input>
                        </div>
                        <template if:true={isInwardRemittance}>
                            <div class="slds-col slds-size_1-of-2">
                                <legend class="slds-form-element__legend slds-form-element__label">Unidentified Receipt</legend>
                                <lightning-input data-name="unidentifiedReceipt" type="checkbox" checked={isUnidentifiedReceipt} onchange={handleUnidentifiedReceiptChange}></lightning-input>
                            </div>
                        </template>    
                        <div class="slds-col slds-size_1-of-2 slds-p-right_xx-small" if:false={isUnidentified}>
                            <template if:true={bankNames.data}>
                                <legend class="slds-form-element__legend slds-form-element__label">Bank Name</legend>
                                <lightning-combobox disabled={disableForCrypto} name="Currency" value={customerBankName}  onchange={handleChangeCustomerBankName} required={bankNameRequired} options={bankNames.data.values}></lightning-combobox>
                            </template> 
                        </div>
                        <div class="slds-col slds-size_1-of-2 slds-p-right_xx-small" if:true={isUnidentified}>
                            <legend class="slds-form-element__legend slds-form-element__label">Project Name</legend>
                            <lightning-combobox disabled={disableForCrypto} name="project"  onchange={handleProjectChange} options={projectOptions}></lightning-combobox>
                        </div>
                        <div class="slds-col slds-size_1-of-2" if:false={isUnidentified}>
                            <legend class="slds-form-element__legend slds-form-element__label">Bank Account Number</legend>
                            <lightning-input disabled={disableForCrypto} data-name="customerBankNumber" value={customerBankNumber} onchange={handleChange}></lightning-input>    
                        </div>
                        <div class="slds-col slds-size_1-of-2" if:true={isUnidentified}>
                            <legend class="slds-form-element__legend slds-form-element__label">Corporate Or Escrow Account</legend>
                            <lightning-combobox disabled={disableForCrypto} name="accountoptionname"  onchange={handleAccountOptionChange} required options={accountOptions}></lightning-combobox>  
                        </div>
                        <div class="slds-col slds-size_1-of-2" if:true={isUnidentified}>
                            <template if:true={enableCorpBankOptions}>
                                <legend class="slds-form-element__legend slds-form-element__label">Select Corporate Bank Account Number</legend> <!-- ASF-3419 - Edit -->
                                <lightning-combobox name="corporateBankname"  onchange={handleAccountOptionChange} required options={corporatebankOptions}></lightning-combobox>  
                        </template>
                        </div>
                        <template if:false={enableCorpBankOptions}> <!-- ASF-3419 - Edit -->
                            <div class="slds-col slds-size_1-of-2" if:true={isUnidentified}>
                                <legend class="slds-form-element__legend slds-form-element__label">Account Number</legend>
                                <div class="slds-form-element__control">
                                    <label class="slds__label">{accountNumber}</label>  
                                </div>
                                
                            </div>
                        </template> <!-- ASF-3419 - Edit -->
                        <div class="slds-col slds-size_1-of-2 slds-p-right_xx-small" if:true={isUnidentified}> <!--ASF-3401- start-->
                            <legend class="slds-form-element__legend slds-form-element__label">Virtual Account Name</legend>
                            <lightning-input disabled={disableForCrypto} name="virtualAccountName"  value={virtualAccountName} onchange={handlevirtualAccountNameChange}></lightning-input>
                        </div><!--ASF-3401- End-->
						<div class="slds-col slds-size_1-of-2 slds-p-right_xx-small" if:true={isUnidentified}>
                            <legend class="slds-form-element__legend slds-form-element__label">Create Third Party Payment Case</legend>
                            <lightning-input checked={createCase} type="checkbox" name="createCase"  onchange={handleCreateCaseChange} ></lightning-input>
                        </div>
                    </div>
                    <legend class="slds-form-element__legend slds-form-element__label">Remarks</legend>
                    <lightning-textarea placeholder="Please add your comments" value={remarks} data-name="remarks" required onchange={handleChange} max-length="255"></lightning-textarea>
                    <div class="slds-grid slds-wrap" if:false={isUnidentified}>
                        <div class="slds-col slds-size_1-of-2 slds-p-right_xx-small">
                            <lightning-input data-id="paymentFiles" label="Attach Payment Detail" name="uploadFile" type="file" accept={acceptedFormats} onchange={onFileUpload} value={uploadedFiles}   multiple>  
                            </lightning-input>
                            <template if:true={uploadedFiles}>
                                <div class="uploaded-file-names-container">
                                    <template for:each={uploadedFiles} for:item="file">
                                        <div key={file.Title} class="uploaded-file-item">
                                            <img src={uploadeFileIcon} class="uploaded-file-icon">
                                            <p class="uploaded-file-name-txt slds-form-element__legend slds-form-element__label">{file.Title}</p>
                                            <a class="remove-file-wrapper" onclick={removeFile}
                                                data-id={file.Title}
                                                data-listname="uploadedFiles"><img
                                                    src={deleteFileIcon}></a>
                                        </div>
                                    </template>
                                </div>
                            </template>
                        </div>
                        <div if:true={receiptFromSR} class="slds-col slds-size_1-of-2">
                                <legend class="slds-form-element__legend slds-form-element__label">Paid By</legend>
                                <lightning-combobox data-name="payFromAccountId" value={payFromAccountId}  onchange={handleChange} options={accountList}></lightning-combobox>
                        </div>                            
                    </div>       

                    <!-- FIN-75: Sai Kumar - Bulk Installment Allocation changes -->
                    <!-- FIN-147: Sai Kumar - Defaulting logic for Installment Number = 1 and Payment Type = "Online" -->
                    <template if:true={isPaymentTypeOnline}>
                        <template if:true={isBulkAllocationEnabled}>
                            <template if:true={hasItemsToShow}>
                                <div class="slds-grid slds-wrap slds-p-around_medium">
                                    <div class="slds-col slds-size_1-of-1">
                                        <div class="slds-form-element">
                                            <div class="slds-form-element__control">
                                                <lightning-input type="checkbox" 
                                                               label="Send Unified Payment Link" 
                                                               data-name="bulkInstallments" 
                                                               checked={bulkInstallments} 
                                                               onchange={handleBulkInstallmentsChange}>
                                                </lightning-input>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <template if:true={showBulkSelection}>
                                        <template if:true={hasItemsToShow}>
                                            <div class="slds-col slds-size_1-of-1 slds-p-top_medium">
                                                <div class="slds-text-heading_small slds-p-bottom_small">Select Payment Items</div>
                                                <div class="slds-box slds-theme_default">
                                                    <template if:true={installmentList}>
                                                        <template for:each={installmentList} for:item="installment">
                                                            <div key={installment.Id} class="slds-grid slds-gutters slds-p-around_xx-small">
                                                                <div class="slds-col slds-size_1-of-12">
                                                                    <lightning-input type="checkbox" 
                                                                                   checked={installment.selected} 
                                                                                   data-id={installment.Id}
                                                                                   onchange={handleInstallmentSelection}>
                                                                    </lightning-input>
                                                                </div>
                                                                <div class="slds-col slds-size_11-of-12">
                                                                    <div class="slds-text-body_regular">
                                                                        Installment {installment.InstallmentNumber__c} - {installment.InstallmentAmount__c} {installment.CurrencyIsoCode}
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </template>
                                                    </template>
                                                    
                                                    <template if:true={otherCharges}>
                                                        <template for:each={otherCharges} for:item="charge">
                                                            <div key={charge.Id} class="slds-grid slds-gutters slds-p-around_xx-small slds-p-top_medium">
                                                                <div class="slds-col slds-size_1-of-12">
                                                                    <lightning-input type="checkbox" 
                                                                                   checked={charge.selected} 
                                                                                   data-id={charge.Id}
                                                                                   onchange={handleChargeSelection}>
                                                                    </lightning-input>
                                                                </div>
                                                                <div class="slds-col slds-size_11-of-12">
                                                                    <div class="slds-text-body_regular">
                                                                        {charge.TypeOfCharge__c} - {charge.PendingAmount__c} {currencyISO}
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </template>
                                                    </template>
                                                </div>
                                            </div>
                                        </template>
                                        <template if:false={hasItemsToShow}>
                                            <div class="slds-col slds-size_1-of-1 slds-p-top_medium">
                                                <div class="slds-text-align_center slds-text-color_weak">
                                                    No installments or charges available for selection
                                                </div>
                                            </div>
                                        </template>
                                    </template>
                                </div>
                            </template>
                        </template>
                    </template>

        </div>
        <div class="slds-modal__footer">
                    <!-- Added by Sai Kumar as part of DFC-4 story -->
                <template if:false={isInwardRemittance}>
            <template if:false={isUnidentified}>
                            <lightning-button if:true={receiptFromSR} variant="Brand" label="Save Receipt & Allocation"
                                disabled={disableAllocationButton} onclick={handleSaveAllocation}
                                alternative-text="Save Receipt & Allocation" title="Save Receipt & Allocation"
                                required></lightning-button>
            </template>
                        <lightning-button variant="Brand" class="slds-var-m-left_x-small" label="Save Receipt"
                            disabled={disableSave} onclick={handleSave} alternative-text="Save Receipt"
                            title="Save Receipt" required></lightning-button>
                    </template>
                    <!-- Added by Sai Kumar as part of DFC-4 story -->
                <template if:true={isInwardRemittance}>
                    <template if:false={isUnidentified}>
                            <lightning-button if:true={receiptFromSR} variant="Brand" label="Save Receipt & Allocation"
                                onclick={handleSaveAllocation} alternative-text="Save Receipt & Allocation"
                                title="Save Receipt & Allocation" required></lightning-button>
                    </template>
                    <template if:true={isUnidentified}>
                            <lightning-button variant="Brand" class="slds-var-m-left_x-small" label="Save Receipt"
                                onclick={handleSave} alternative-text="Save Receipt" title="Save Receipt"
                                required></lightning-button>
                    </template>
                </template>
        </div> 
        </div>
        </section>
        <div class="slds-backdrop slds-backdrop_open" role="presentation"></div>
    </template>

    <template if:true={isLoading}>
        <lightning-spinner class="slds-is-fixed" style="z-index: 9999;" alternative-text="Loading..." size="small">
        </lightning-spinner>
    </template>
</template>