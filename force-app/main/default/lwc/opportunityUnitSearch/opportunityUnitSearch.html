<template>
	<template if:true={isBlocked}>
       <p class="blockedStatus">{blockedMessage}</p>
	</template>
	<template if:false={isBlocked}>
	<article class="slds-card slds-p-around_x-small">
		<div class="spinner">
			<template if:true={isLoading}>
				<lightning-spinner alternative-text="Loading" variant="brand" size="large">
				</lightning-spinner>
			</template>
		</div>
		<div class="slds-card__header slds-grid">
			<header class="slds-media slds-media_center slds-has-flexi-truncate">
				<div class="slds-media__figure">
					<lightning-icon icon-name="standard:groups" size="medium" alternative-text="Unit Search">
					</lightning-icon>
				</div>
				<div class="slds-media__body">
					<h2 class="slds-card__header-title">
						<a href="javascript:void(0);" class="slds-card__header-link slds-truncate" title="Unit Search">
							<span>Unit Search</span>
						</a>
						<template if:true={ReservationWizard}>
							&nbsp;
							<c-custom-timer redirect-to={redirecPageUrl} > </c-custom-timer>
							
						</template>
						<template if:true={BookingWizard}>
							&nbsp;
							<c-custom-timer redirect-to={redirecPageUrl} > </c-custom-timer>
							
						</template>
					</h2>
					
				</div>
				<div class="slds-no-flex">

					<div class="slds-button-group" role="group">
						<template if:false={disablPath}>
							<lightning-button name="BACK" label="Back" icon-name="utility:back" slot="actions"
								disabled={disableBack} onclick={handleMenuAction}></lightning-button>
							
							<template if:false={reserveMemoFlowButton}>
								<lightning-button name="FORWARD" label="Proceed" icon-name="utility:forward"
									slot="actions" icon-position="right" disabled={disableProceed}
									onclick={handleMenuAction}></lightning-button>
							</template>

							<template if:true={memoFlow}>
								<lightning-button name="FORWARDMEMO" label="Proceed with Memo"
									icon-name="utility:forward" slot="actions" icon-position="right"
									disabled={disableProceed} onclick={handleMenuAction}></lightning-button>
							</template>

							<template if:true={reserveFlowButton}>
								<lightning-button name="Reserve Unit" label="Submit for Approval"
									icon-name="utility:forward" slot="actions" icon-position="right"
									onclick={handleReservation}></lightning-button>
							</template>

						</template>
						<template if:true={disablPath}>
							<template if:false={isPostSalesProfile}>
								<lightning-button name="RELEASEUNIT" label="Release Unit/s" icon-name="utility:pdf_ext"
									slot="actions" title={releaseTooltipMessage} disabled={isReleaseButtonDisabled} onclick={handleMenuAction} ></lightning-button>
									<template if:true={disableReleaseUnit}>
									<template if:true={releaseUnitValidationMessage}>
										<lightning-helptext content={releaseUnitValidationMessage}></lightning-helptext>
									</template>
								</template>
								&nbsp;
								<lightning-button name="REQUESTOASSIGN" label="Request to Assign" icon-name="utility:pdf_ext"
									slot="actions" disabled={disableOffer} onclick={handleMenuAction}></lightning-button>
								&nbsp;
								<lightning-button name="OFFER" label="Generate Offer" icon-name="utility:pdf_ext"
									slot="actions" disabled={disableOffer} onclick={handleMenuAction}></lightning-button>
								&nbsp;
								<lightning-button name="MEMO" label="Generate Memo" icon-name="utility:edit_form"
									slot="actions" disabled={disableMemo} onclick={handleMenuAction}></lightning-button>
								&nbsp;
								<lightning-button name="RESERVE" label="Reserve Unit/s" icon-name="utility:edit_form"
									slot="actions" disabled={disableReserve} onclick={handleMenuAction}></lightning-button>
								<template if:true={disableReserve}>
									<template if:true={registrationValidationMessage}>
										<lightning-helptext content={registrationValidationMessage}></lightning-helptext>
									</template>
								</template>
								&nbsp;
							</template>
							<lightning-button name="BOOKING" label="Book Unit/s" icon-name="utility:entitlement"
								slot="actions" disabled={disableBooking} onclick={handleMenuAction}></lightning-button>
							<template if:true={disableBooking}>
								<template if:true={registrationValidationMessage}>
									<lightning-helptext content={registrationValidationMessage}></lightning-helptext>
								</template>
							</template>
							
							&nbsp; &nbsp;
							<ul class="slds-global-actions" slot="actions">
								<li class="slds-global-actions__item">
									<div class="slds-dropdown-trigger slds-dropdown-trigger_click">
									<template if:true={budgetCheckProfileAllowed}>
										<template if:true={projectRecord}>
											<template if:true={projectRecord.ProjectBudget__c}>
												<button onclick={openModal}	class="slds-button slds-button_icon slds-button_icon slds-button_icon-container slds-button_icon-small slds-global-actions__notifications slds-global-actions__item-action slds-incoming-notification"
													title="Budget Check" aria-live="assertive" aria-atomic="true">
													<lightning-icon icon-name="utility:moneybag" alternative-text="Budget Check"
														title="Budget Check"
														style="--sds-c-icon-color-foreground-default: rgb(1, 118, 211)">
													</lightning-icon>
													
												</button>
												&nbsp; &nbsp;
											</template>
										</template>
									</template>
										<template if:true={disableOffer}>
											<button
												class="slds-button slds-button_icon slds-button_icon slds-button_icon-container slds-button_icon-small slds-global-actions__notifications slds-global-actions__item-action slds-incoming-notification"
												title="1 new notifications" aria-live="assertive" aria-atomic="true">
												<lightning-icon icon-name="utility:cart" alternative-text="cart"
													title="cart"></lightning-icon>
												<span class="slds-assistive-text">{totalSelectedUnits}</span>
											</button>
										</template>
										<template if:false={disableOffer}>
											<button
												class="slds-button slds-button_icon slds-button_icon slds-button_icon-container slds-button_icon-small slds-global-actions__notifications slds-global-actions__item-action slds-incoming-notification"
												title="1 new notifications" aria-live="assertive" aria-atomic="true">
												<lightning-icon icon-name="utility:cart" alternative-text="cart"
													title="cart"
													style="--sds-c-icon-color-foreground-default: rgb(1, 118, 211)">
												</lightning-icon>
												<span class="slds-assistive-text">{totalSelectedUnits}</span>
											</button>
											<span aria-hidden="true"
												class="slds-notification-badge slds-incoming-notification slds-show-notification">{totalSelectedUnits}</span>
										</template>
									</div>
								</li>
							</ul>
						</template>
					</div>

				</div>
			</header>
		</div>
		<template if:false={disablPath}>
			<br />
			<lightning-progress-indicator current-step={pageNumber} type="path" variant="base">

				<template for:each={steps} for:item="step">
					<lightning-progress-step label={step.label} value={step.value} key={step.label}>
					</lightning-progress-step>
				</template>

			</lightning-progress-indicator>
			<br />
		</template>
		<div class="slds-grid slds-container--fluid slds-gutters slds-grid_vertical-align-end">
		</div>
		<template if:true={showPage1}>
			<div class="slds-card__body">
				<div class="slds-grid slds-container--fluid slds-gutters slds-grid_vertical-align-end">
					<div class="filter-col slds-col slds-size_3-of-12">
						<lightning-combobox dropdown-alignment="auto" name="Projects" label="Projects" value={selectedProject}
							options={projectList} onchange={handleProjectChange}>
						</lightning-combobox>
					</div>
					<div class="filter-col slds-col slds-size_3-of-12">
						<lightning-combobox dropdown-alignment="auto" name="Building/Section" label="Building/Section" value={selectedBuilding}
							options={buildingList} onchange={handleBuildingChange}>
						</lightning-combobox>
					</div>
					<div class="filter-col slds-col slds-size_3-of-12">
						<lightning-combobox dropdown-alignment="auto" name="Property Usage" label="Property Usage" options={propertyUsageList}
							onchange={handleFilterChange} class="unitFilter" data-field-api="PropertyUsage__c">
						</lightning-combobox>
					</div>
					<div class="filter-col slds-col slds-size_3-of-12">
						<lightning-combobox dropdown-alignment="auto" name="Unit Types" label="Unit Types" options={unitTypesSetList}
							onchange={handleFilterChange} class="unitFilter" data-field-api="UnitType__c">
						</lightning-combobox>
					</div>
				</div>
				<div class="slds-grid slds-container--fluid slds-gutters slds-grid_vertical-align-end">
					<div class="filter-col slds-col slds-size_3-of-12">
						<lightning-combobox dropdown-alignment="auto" name="Unit Model" label="Unit Model" options={unitModelSetList}
							onchange={handleFilterChange} class="unitFilter" data-field-api="UnitModel__c">
						</lightning-combobox>
					</div>
					<div class="filter-col slds-col slds-size_3-of-12">
						<lightning-combobox dropdown-alignment="auto" name="Floor Number" label="Floor Number" options={floorNumberSetList}
							onchange={handleFilterChange} class="unitFilter" data-field-api="FloorNumber__c">
						</lightning-combobox>
					</div>
					<div class="filter-col slds-col slds-size_3-of-12">
						<lightning-combobox dropdown-alignment="auto" name="Bed Rooms" label="Bed Rooms" options={unitBedRoomsSetList}
							onchange={handleFilterChange} class="unitFilter" data-field-data-type="number"
							data-field-api="NumberOfBedrooms__c">
						</lightning-combobox>
					</div>
					<div class="filter-col slds-col slds-size_3-of-12">
						<lightning-combobox dropdown-alignment="auto" name="View" label="View" options={unitViewSetList}
							onchange={handleFilterChange} class="unitFilter" data-field-api="UnitView__c">
						</lightning-combobox>
					</div>
				</div>
				<div class="slds-p-around_x-small slds-table_edit_container slds-scrollable" style="padding-left: 0">
					<div class="slds-table_edit_container slds-is-relative">
						<table aria-multiselectable="true"
							class="slds-table slds-no-row-hover slds-table_bordered slds-table_col-bordered slds-table_edit "
							role="grid">
							<thead>
								<tr class="slds-line-height_reset">
									<template if:false={isExport}>
										<th class="" scope="col"
											style="padding: var(--lwc-tableCellSpacing,0.25rem 0.5rem);">
										</th>
									</template>
									<th scope="col" style="padding: var(--lwc-tableCellSpacing,0.25rem 0.5rem);">
										Unit Name
									</th>
									<th scope="col" style="padding: var(--lwc-tableCellSpacing,0.25rem 0.5rem);">
										Assigned To
									</th>
									<th scope="col" style="padding: var(--lwc-tableCellSpacing,0.25rem 0.5rem);">
										Number Of Bedrooms
									</th>
									<th scope="col" style="padding: var(--lwc-tableCellSpacing,0.25rem 0.5rem);">
										Unit Type
									</th>
									<th scope="col" style="padding: var(--lwc-tableCellSpacing,0.25rem 0.5rem);">
										Property Usage
									</th>
									<th scope="col" style="padding: var(--lwc-tableCellSpacing,0.25rem 0.5rem);">
										Unit Model
									</th>
									<th scope="col" style="padding: var(--lwc-tableCellSpacing,0.25rem 0.5rem);">
										Floor Number
									</th>
									<th scope="col" style="padding: var(--lwc-tableCellSpacing,0.25rem 0.5rem);">
										Unit View
									</th>
									<th scope="col" style="padding: var(--lwc-tableCellSpacing,0.25rem 0.5rem);">
										Unit Category
									</th>
									<th scope="col" style="padding: var(--lwc-tableCellSpacing,0.25rem 0.5rem);">
										Terrace Area
									</th>
									<th scope="col" style="padding: var(--lwc-tableCellSpacing,0.25rem 0.5rem);">
										Total Area
									</th>
									<th scope="col" style="padding: var(--lwc-tableCellSpacing,0.25rem 0.5rem);">
										Unit Plot Area
									</th>
									<th scope="col" style="padding: var(--lwc-tableCellSpacing,0.25rem 0.5rem);">
										Selling Price
									</th>
									<th scope="col" style="padding: var(--lwc-tableCellSpacing,0.25rem 0.5rem);">
										Online Reservation Fee
									</th>
								</tr>
							</thead>
							<tbody>
								<template if:true={unitDataTable}>
									<template for:each={unitDataTable} for:item="item" for:index="indexVar">
										<tr key={item.unitDetails} aria-selected="false" class="slds-hint-parent">
											<template if:false={isExport}>
												<td class="slds-cell-edit" role="gridcell" tabindex="0">
													<lightning-input class="rowSelector" type="checkbox"
														data-id={item.unitDetails.Id}
														data-unit-name={item.unitDetails.Name}
														data-unit-project={item.unitDetails.ProjectName__c}
														data-unit-asc={item.unitDetails.AnticipatedServiceCharges__c}
														data-unit-pmf={item.unitDetails.BuildingSectionName__r.PropertyManagementFee__c}
														data-unit-multipurposeamount ={item.unitDetails.MultiPurposeAmount__c}
														data-unit-unittype ={item.unitDetails.UnitType__c}
														data-unit-totalrooms ={item.unitDetails.TotalRooms__c}
														data-unit-saleablearea ={item.unitDetails.SaleableArea__c}
														data-unit-measuredarea ={item.unitDetails.MeasuredArea__c}
														data-unit-terracearea ={item.unitDetails.TerraceArea__c}
														data-unit-onlinereservationfee={item.unitDetails.OnlineReservationFee__c}
														data-unit-hmf={item.unitDetails.BuildingSectionName__r.HomeMaintenanceFee__c}
														data-unit-unitprice={item.unitDetails.SellingPrice__c}
														data-unit-reservationamount={item.unitDetails.BuildingSectionName__r.ReservationAmount__c}
														data-unit-assignedtouser={item.unitDetails.AssignedToUser__c}
														data-unit-reservationpaymentmethod = {item.unitDetails.Project__r.Reservation_Payment_Method__c}
														onchange={handleRowSelect} checked={item.isSelected}
														value={item.isSelected} disabled={isDisabled}></lightning-input>
												</td>
											</template>
											<td class="slds-cell-edit" role="gridcell" tabindex="0">
												<span class="slds-grid slds-grid_align-spread">
													<template if:false={isExport}>
														<lightning-button variant="base" label={item.unitDetails.Name}
															value={item.unitDetails.Id} title={item.unitDetails.Name}
															onclick={navigateToRecordPage} class="slds-m-left_x-small">
														</lightning-button>
													</template>
													<template if:true={isExport}>
														{item.unitDetails.Name}
													</template>
												</span>
											</td>
											<td if:true={item.unitDetails.AssignedToUser__r} class="slds-cell-edit" role="gridcell" tabindex="0">
												<span class="slds-grid slds-grid_align-spread">
													{item.unitDetails.AssignedToUser__r.Name}
												</span>
											</td>
											<td if:false={item.unitDetails.AssignedToUser__r} class="slds-cell-edit" role="gridcell" tabindex="0">
												<span class="slds-grid slds-grid_align-spread">
													
												</span>
											</td>
											<td class="slds-cell-edit" role="gridcell" tabindex="0">
												<span class="slds-grid slds-grid_align-spread">
													{item.unitDetails.NumberOfBedrooms__c}
												</span>
											</td>
											<td class="slds-cell-edit" role="gridcell" tabindex="0">
												<span class="slds-grid slds-grid_align-spread">
													{item.unitDetails.UnitType__c}
												</span>
											</td>
											<td class="slds-cell-edit" role="gridcell" tabindex="0">
												<span class="slds-grid slds-grid_align-spread">
													{item.unitDetails.PropertyUsage__c}
												</span>
											</td>
											<td class="slds-cell-edit" role="gridcell" tabindex="0">
												<span class="slds-grid slds-grid_align-spread">
													{item.unitDetails.UnitModel__c}
												</span>
											</td>
											<td class="slds-cell-edit" role="gridcell" tabindex="0">
												<span class="slds-grid slds-grid_align-spread">
													{item.unitDetails.FloorNumber__c}
												</span>
											</td>
											<td class="slds-cell-edit" role="gridcell" tabindex="0">
												<span class="slds-grid slds-grid_align-spread">
													{item.unitDetails.UnitView__c}
												</span>
											</td>
											<td class="slds-cell-edit" role="gridcell" tabindex="0">
												<span class="slds-grid slds-grid_align-spread">
													{item.unitDetails.UnitCategory__c}
												</span>
											</td>
											<td class="slds-cell-edit" role="gridcell" tabindex="0">
												<span class="slds-grid slds-grid_align-spread">
													<p> <lightning-formatted-number  class="table-input" value={item.unitDetails.TerraceArea__c} minimum-fraction-digits="2" maximum-fraction-digits="2" readonly ></lightning-formatted-number></p>															
												</span>
											</td>
											<td class="slds-cell-edit" role="gridcell" tabindex="0">
												<span class="slds-grid slds-grid_align-spread">
													<p> <lightning-formatted-number class="table-input" value={item.unitDetails.TotalArea__c} minimum-fraction-digits="2" maximum-fraction-digits="2" readonly></lightning-formatted-number></p>															
												</span>
											</td>
											<td class="slds-cell-edit" role="gridcell" tabindex="0">
												<span class="slds-grid slds-grid_align-spread">
													<p> <lightning-formatted-number  class="table-input" value={item.unitDetails.UnitPlotArea__c} minimum-fraction-digits="2" maximum-fraction-digits="2" readonly ></lightning-formatted-number></p>															
												</span>
											</td>
											<td class="slds-cell-edit" role="gridcell" tabindex="0">
												<span class="slds-grid slds-grid_align-spread">
													<p> <lightning-formatted-number format-style="currency" class="table-input" value={item.unitDetails.SellingPrice__c} minimum-fraction-digits="2" maximum-fraction-digits="2" readonly currency-code={defaultCurrency} currency-display-as="code"></lightning-formatted-number></p>															
												</span>
											</td>
											<td class="slds-cell-edit" role="gridcell" tabindex="0">
												<span class="slds-grid slds-grid_align-spread">
													<p> <lightning-formatted-number format-style="currency" class="table-input" value={item.unitDetails.OnlineReservationFee__c} minimum-fraction-digits="2" maximum-fraction-digits="2" readonly currency-code={defaultCurrency} currency-display-as="code"></lightning-formatted-number></p>															
												</span>
											</td>
										</tr>
									</template>
								</template>
							</tbody>
						</table>
					</div>
				</div>
			</div>
		</template>
		<!-- Page 2 Start -->
		<template if:true={showPage2}>
			<template if:true={memoFlow}>
				<div class="slds-card__body">
				<p><i><b> This memo is only applicable for requesting any additional discount, Change in payment plan, offers and commission or any other benefits towards the unit. 
						For booking standard process exceptions, please raise special condition approval request to line manager post booking at sales order level.
					</b></i></p> <br/>
					<div class="slds-grid slds-container--fluid slds-gutters slds-grid_vertical-align-top">
						<div class="filter-col slds-col slds-size_12-of-12">
							<div class="slds-grid slds-wrap">


								<div class="custom-row">
<div class="custom-cell">

	<label>Memo Type</label><abbr style="color: red;"> *</abbr>
									<lightning-record-edit-form object-api-name="BookingMemo__c" style="margin-bottom: 1rem;">
										<lightning-input-field name="memoTypeField" value={memoTypeField} field-name="MemoType__c"
											variant="label-hidden" aria-required="true" onchange={handleChange} >
										</lightning-input-field>
									</lightning-record-edit-form>
</div>

<div class="custom-cell">

	<label>Memo Subject</label><abbr style="color: red;"> *</abbr>
									<lightning-input type="text" variant="label-hidden" aria-required="true"
										name="memoSubjectField" value={memoSubjectField} placeholder="Memo Subject" onkeyup={handleKeyUp} >
									</lightning-input>
</div>

								</div>
								<div class="custom-row">
									<div class="custom-cell">
										<label>Memo Header</label><abbr style="color: red;"> *</abbr>
									<lightning-textarea type="text" variant="label-hidden" aria-required="true"
										name="memoHeaderField" value={memoHeaderField} placeholder="Memo Header" onkeyup={handleKeyUp} >
									</lightning-textarea>
									</div>	

									<div class="custom-cell">
										<label>Special Note</label>
									<lightning-textarea type="text" variant="label-hidden" aria-required="true"
										name="specialNoteField" value={specialNoteField} placeholder="Special Note" onkeyup={handleKeyUp} >
									</lightning-textarea>
									</div>	
								</div>
							</div>
						</div>
					</div>
				</div>
			</template>
			<div class="slds-card__body">
				<div class="slds-grid slds-container--fluid slds-gutters slds-grid_vertical-align-top">
					<div class="filter-col slds-col slds-size_12-of-12">
						<lightning-tabset variant="scoped">
							<template for:each={selectedUnitList} for:item="item" for:index="indexVar">
								<lightning-tab key={item.unitId} label={item.unitName} value={item.unitId}
									onactive={handlePaymentUnitSelect}>

									<div class="slds-grid slds-wrap slds-p-around_small" style="padding-left: unset;">
										<div class="filter-col slds-col slds-size_12-of-12" style="padding-left: unset;">
											<div class="slds-grid slds-wrap">
												<template if:true={item.salesOfferDetails}>
												<template if:false={memoFlow}>

												<div class="filter-col slds-col slds-size_2-of-12" style="padding-left: unset;">
													<template if:false={item.salesOfferDetails.hasUnitDesign}>
														<template if:true={item.salesOfferDetails.unitRecord.BuildingSectionName__r.EligibileforMultiPurposeRoom__c}>
																<div class="check-box-container">
																<label>Premium</label>
																<lightning-input  type="checkbox" disabled ={item.salesOfferDetails.unitRecord.Mandatory_Premium__c} variant="label-hidden" value={item.salesOfferDetails.multiPurposeAmountApplicable}
																aria-required="true" name="MultiPurposeRoomField"
																onchange={handleMultiPurposeRoomChange} data-record-id={item.unitId} class="multiPurposeRoomField">
																</lightning-input>
															</div>
														</template>
													</template>	
													<template if:true={item.salesOfferDetails.hasUnitDesign}>
														<div class="check-box-container">
															<label>Premium</label>
															<lightning-input type="checkbox" variant="label-hidden" value={item.salesOfferDetails.multiPurposeAmountApplicable}
															aria-required="true" name="MultiPurposeRoomField"
															onchange={handleMultiPurposeRoomChange} data-record-id={item.unitId} class="multiPurposeRoomField">
															</lightning-input>
														</div>
													</template>
												</div> 
											
											<template if:true={item.salesOfferDetails.unitRecord.BuildingSectionName__r.EligibleforUnitFinishes__c}>
												<div class="filter-col slds-col slds-size_3-of-12" style="padding-left: unset;">
													
														</label><abbr style="color: red;">*</abbr><label>Unit Finishing </label>
														<lightning-combobox label="Status" required dropdown-alignment="auto" name="unitFinishingField" variant="label-hidden" 
															options={item.salesOfferDetails.unitFinishingVals} onchange={handleUnitFinishesChange} data-record-id={item.unitId} class="unitFinishingField"></lightning-combobox>
															
												</div>
											</template>
											<template for:each={item.salesOfferDetails.unitAddons} for:item="unitadd">
												<div class="filter-col slds-col slds-size_3-of-12" style="padding-left: unset;" key={unitadd.UnitAddonName}>
													
												</label><abbr style="color: red;">*</abbr><label>{unitadd.UnitAddonName}</label>
												<lightning-combobox label="Status" required dropdown-alignment="auto" name={unitadd.UnitAddonName} variant="label-hidden" 
													options={unitadd.UnitsubAddonWrapperList} onchange={handleUnitAddonChange} data-record-id={item.unitId} class="unitAddonField"></lightning-combobox>
													
										</div>
											</template>
											

											<template if:true={item.salesOfferDetails.unitRecord.BuildingSectionName__r.EligibleforPodium__c}>
												<div class="filter-col slds-col slds-size_3-of-12" style="padding-left: unset;">
												</label><abbr style="color: red;"> *</abbr><label>POD </label>
														<lightning-combobox required="true" dropdown-alignment="auto" value={selectedPodium} name="podiumSelectionfi" variant="label-hidden" 
															options={item.salesOfferDetails.availablePodiumChoices} onchange={handleUnitPodiumChange} data-record-id={item.unitId} class="podiumSelectionfi"></lightning-combobox>
												</div>
											</template>
											<!-- swimming pool related changes for yas riva -->
											<template if:true={item.salesOfferDetails.unitRecord.Swimming_Pool_Price__c}>
												<div class="filter-col slds-col slds-size_3-of-12" style="padding-left: unset;">
												</label><abbr style="color: red;"> *</abbr><label>Swimming Pool </label>
														<lightning-combobox required="true" dropdown-alignment="auto" name="swimmingSelectionfi" variant="label-hidden" 
															options={item.salesOfferDetails.availableSwimmingPoolChoices} onchange={handleUnitSwimmingPoolChange} data-record-id={item.unitId} class="swimmingSelectionfi"></lightning-combobox>
												</div>
											</template>

											<template if:true={item.salesOfferDetails.unitRecord.EligibleforUnitFurnishing__c}>
												<div class="filter-col slds-col slds-size_3-of-12" style="padding-left: unset;">
													
														<label>Unit Furnishing</label>
														<lightning-combobox dropdown-alignment="auto" name="unitFurnishingField" variant="label-hidden" 
															options={unitFurnishingVals} onchange={handleUnitFurnishingChange} data-record-id={item.unitId} class="unitFurnishingField"></lightning-combobox>
												
												</div>
											</template>
												<div class="filter-col slds-col slds-size_3-of-12" style="padding-left: unset;">
													&nbsp;
													<template if:true={item.salesOfferDetails.hasUnitDesign}>
														<label>Unit Design</label>
														<lightning-combobox dropdown-alignment="auto" name="unitDesiagnField" variant="label-hidden" 
															options={item.salesOfferDetails.availableUnitDesigns} onchange={handleDesignChange} data-record-id={item.unitId} class="unitDesiagnField"></lightning-combobox>
													</template>
												</div>
												</template>
											</template>
											</div>
											
										</div>
										<div class="filter-col slds-col slds-size_12-of-12" style="padding-left: unset;">
											<div class="slds-grid slds-wrap custom-margin"  style="padding-left: unset;">
												<div class="filter-col slds-col slds-size_2-of-12 ddl-title-container" style="padding-left: unset;">
													<h1 class="ddl-title">Payment And Offer</h1>
												</div>
												<div class="filter-col slds-col slds-size_3-of-12" style="padding-left: unset;">
												<template if:true={item.salesOfferDetails}>
													<template if:true={item.salesOfferDetails.availablePaymentPlans}>													
														<template if:false={reserveBookingFlow}>
															<lightning-combobox dropdown-alignment="auto" name={item.unitId} 
															placeholder="Select Payment Plan" value={selectedPaymentPlan}
															options={item.salesOfferDetails.availablePaymentPlans}
															onchange={selectPaymentPlan} data-record-id={item.unitId} class="selectedPaymentPlan"></lightning-combobox>
														</template>
															
		
															<template if:true={reserveBookingFlow}>													
																<lightning-combobox dropdown-alignment="auto"  
																placeholder="Payment Plan" value={selectedPaymentPlan}
																options={item.salesOfferDetails.availablePaymentPlansWithMemo}
																onchange={selectPaymentPlan} data-record-id={item.unitId} class="selectedPaymentPlan"></lightning-combobox>
															</template>							
															<!-- Show Pills-->
															<template if:false={hidePill}>
																<div class="slds-grid slds-wrap slds-p-around_xx-top">
																	<template
																		if:true={item.salesOfferDetails.applicablePaymentPlansCalculated}>
																		<template
																			for:each={item.salesOfferDetails.applicablePaymentPlansCalculated}
																			for:item="paymentItem"
																			for:index="paymentItemIndexVar">
																			<template if:true={paymentItem.isSelected}>
																				<lightning-pill
																					key={paymentItem.paymentPlanDetails.Id}
																					class="slds-m-around_xx-small"
																					name={paymentItem.paymentPlanDetails.Id}
																					label={paymentItem.paymentPlanDetails.Name}
																					onremove={unselectPaymentPlan}>
																				</lightning-pill>
																			</template>
																		</template>
																	</template>
																</div>
															</template>
														</template>
													</template>
												</div>
												<div class="filter-col slds-col slds-size_6-of-12">
													<template if:true={item.salesOfferDetails}>
														<template if:true={item.salesOfferDetails.availableOffers}>
															<template if:true={reserveBookingFlow}>
																<!-- label="Select an existing Offers & Promotion" -->
																<lightning-combobox dropdown-alignment="auto" name={item.unitId} 
																placeholder="Select Offer" value={item.offerId}
																options={item.salesOfferDetails.availableWithMemoOffers}
																onchange={handleOfferChange} data-record-id={item.unitId} class="selectedOffer"></lightning-combobox>
															</template>
		
															<template if:false={reserveBookingFlow}>
																<!-- label="Select an existing Offers & Promotion" -->
																<lightning-combobox dropdown-alignment="auto" name={item.unitId} 
																placeholder="Offer" value={item.offerId}
																options={item.salesOfferDetails.availableOffers}
																onchange={handleOfferChange} data-record-id={item.unitId} class="selectedOffer"></lightning-combobox>
															</template>
															
														</template>
													</template>
												</div>
											</div>
										</div>



										<template if:true={memoFlow}>
										<div class="filter-col slds-col slds-size_12-of-12" style="padding-left: unset;">
												<!--======= START: Added by Nikhil (LAS-59) =======-->
												<div class="custom-row">
													<div class="custom-cell">
													<label>Apply Discount Percentage/Amount</label>
													<lightning-combobox dropdown-alignment="auto" variant="label-hidden" options={applyPercentageAmountOptions} value={applyPercentageAmount}
														name="applyPercentageAmount" placeholder="Select Percentage/Amount" onchange={caltculateValue}>
													</lightning-combobox>
													</div>
												</div>
												<!-- ======= END: Added by Nikhil (LAS-59) =======-->
												<div class="custom-row">
													<div class="custom-cell">
														<label>Discount Percentage</label>
												<lightning-input type="number" variant="label-hidden" min="0" step=".01" 
													max="100" aria-required="true" value={item.discountPercentageField} name="discountPercentageField"
													placeholder="Discount Percentage" onchange={caltculateValue} disabled={isAmountSelected}><!--modify by Nikhil (LAS-59)-->
												</lightning-input>
												</div>
												<div class="custom-cell">
													<label>Discount Amount</label>
												<lightning-input type="number" variant="label-hidden"
													aria-required="true" value={item.discountAmountField}
													name="discountAmountField"
													placeholder="Discount Amount" disabled={isPercentageSelected} onchange={caltculateValue}
													class="read-only" step="0.01"><!--modify by Nikhil (LAS-59)-->
												</lightning-input>
												</div>
											</div>
											<div class="custom-row">
												<div class="custom-cell">
													<label>Rebate Percentage</label>
												<lightning-input type="number" variant="label-hidden" min="0" step=".01" 
													max="100" aria-required="true" value={item.rebatePercentageField} name="rebatePercentageField"
													placeholder="Rebate Percentage" onkeyup={caltculateValue} >
												</lightning-input>
												</div>
												<div class="custom-cell">
													<label>Rebate Amount</label>
												<lightning-input type="number" variant="label-hidden"
													aria-required="true" value={item.rebateAmountField}
													name="rebateAmountField"
													placeholder="Rebate Amount" readonly disabled 
													class="read-only" step="0.01">
												</lightning-input>
												</div>
											</div>
											<div class="custom-row">
												<div class="custom-cell">
													<label>SC Waiver Years</label>
												<lightning-input type="number" variant="label-hidden" min="0" step=".01" max="10"
													aria-required="true" value={item.sCWaiverYearsField}
													message-when-range-overflow = 'SC Waiver Years should be between 0 and 10 years' message-when-range-underflow = 'SC Waiver Years should be between 0 and 10 years'
													name="sCWaiverYearsField" placeholder="SC Waiver Years"
													onkeyup={caltculateValue} >
												</lightning-input>
												</div>
												<div class="custom-cell">
													<label>SC Waiver Amount</label>
												<lightning-input type="number" variant="label-hidden"
													aria-required="true" value={item.sCWaiverAmountField}
													name="sCWaiverAmountField"
													placeholder="SC Waiver Amount" readonly disabled
													class="read-only" step="0.01">
												</lightning-input>
												</div>
											</div>
											<div class="custom-row">
												<div class="custom-cell">
													<label>PM Fee Years</label>
												<lightning-input type="number" variant="label-hidden"  min="0" step=".01" max="10"
													aria-required="true" value={item.pMFeeYearsField}
													message-when-range-overflow = 'PM Fee Years should be between 0 and 10 years' message-when-range-underflow = 'PM Fee Years should be between 0 and 10 years'
													name="pMFeeYearsField" placeholder="PM Fee Years"
													onkeyup={caltculateValue} >
												</lightning-input>
												</div>
												<div class="custom-cell">
													<label>PM Fee Amount</label>
												<lightning-input type="number" variant="label-hidden"
													aria-required="true" value={item.pMFeeAmountField}
													name="pMFeeAmountField"
													placeholder="PM Fee Amount" readonly disabled
													class="read-only" step="0.01">
												</lightning-input>
													</div>
												</div>
												<div class="custom-row">
													<div class="custom-cell">
														<label>Home Maintenance Years</label>
												<lightning-input type="number" variant="label-hidden" min="0" step=".01" max="10"
													aria-required="true" value={item.homeMaintenanceYearsField}
													message-when-range-overflow = 'Home Maintenance Years should be between 0 and 10 years' message-when-range-underflow = 'Home Maintenance Years should be between 0 and 10 years'
													name="homeMaintenanceYearsField"
													placeholder="Home Maintenance Years" onkeyup={caltculateValue} >
												</lightning-input>
												</div>
												<div class="custom-cell">
													<label>Home Maintenance Amount</label>
												<lightning-input type="number" variant="label-hidden"
													aria-required="true" value={item.homeMaintenanceAmountField}
													name="homeMaintenanceAmountField"
													placeholder="Home Maintenance Amount" readonly disabled 
													class="read-only" step="0.01">
												</lightning-input>
												</div>
											</div>
												<div class="custom-row">
													<div class="custom-cell">
														<label>ADM Fee Percentage</label>
												<lightning-input type="number" variant="label-hidden" min="0" step=".01" 
													max="2" aria-required="true" value={item.aDMFeePercentageField} 
													message-when-range-overflow = 'ADM Fee Percentage should be between 0% and 2%' message-when-range-underflow = 'ADM Fee Percentage should be between 0% and 2%'
													name="aDMFeePercentageField" placeholder="ADM Fee Percentage"
													onkeyup={caltculateValue} >
														</lightning-input>
													</div>
													<div class="custom-cell">
														<label>ADM Fee Amount</label>
														<lightning-input type="number" variant="label-hidden" value={item.aDMFeeAmountField} aria-required="true" 
															name="aDMFeeAmountField" placeholder="ADM Fee Amount" readonly disabled class="read-only"
															step="0.01">
														</lightning-input>
													</div>
												</div>
											<div class="custom-row">
												<div class="custom-cell">
													<label>Int Commission Percentage</label>
												<lightning-input type="number" variant="label-hidden" min="0" step=".01" 
													max={label.MemoDirectCommission} aria-required="true"
													message-when-range-overflow = {memoDirectCommissionAlert}  message-when-range-underflow = {memoDirectCommissionAlert}
													name="intCommissionPercentageField" value={item.intCommissionPercentageField}
													placeholder="Int Commission Percentage" onkeyup={caltculateValue} >
												</lightning-input>
											</div>
											<div class="custom-cell">
												<label>Int Commission Amount</label>
												<lightning-input type="number" variant="label-hidden"
													aria-required="true" value={item.intCommissionAmountField}
													name="intCommissionAmountField"
													placeholder="Int Commission Amount" readonly disabled 
													class="read-only" step="0.01">
												</lightning-input>
											</div>
										</div>
										<div class="custom-row">
											<div class="custom-cell">
												<label>Broker Commission Percentage</label>
												<lightning-input type="number" variant="label-hidden" min="0" step=".01" 
													max={label.MemoIndirectCommission} aria-required="true" value={item.brokerCommissionPercentageField}
													message-when-range-overflow = {memoIndirectCommissionAlert}  message-when-range-underflow = {memoIndirectCommissionAlert}
													name="brokerCommissionPercentageField"
													placeholder="Broker Commission Percentage"
													onkeyup={caltculateValue} >
												</lightning-input>
										</div>
											<div class="custom-cell">
												<label>Broker Commission Amount</label>
												<lightning-input type="number" variant="label-hidden"
													aria-required="true" value={item.brokerCommissionField}
													name="brokerCommissionField"
													placeholder="Broker Commission Amount" readonly disabled 
													class="read-only" step="0.01">
												</lightning-input>
											</div>
										</div>
										<div class="custom-row">
											<div class="custom-cell">
												<label>Subsidy Percentage</label>
												<lightning-input type="number" variant="label-hidden" min="0" step=".01" 
													max="100" aria-required="true" value={item.subsidyPercentageField} name="subsidyPercentageField"
													placeholder="Subsidy Percentage" onkeyup={caltculateValue} >
												</lightning-input>
											</div>
											<div class="custom-cell">
												<label>Subsidy Amount</label>
												<lightning-input type="number" variant="label-hidden"
													aria-required="true" value={item.subsidyAmountField}
													name="subsidyAmountField" placeholder="Subsidy Amount"
													readonly disabled class="read-only" step="0.01">
												</lightning-input>
											</div>
										</div>
										<div class="custom-row">
											<div class="custom-cell">
												<label>Voucher Name</label>
												<lightning-combobox dropdown-alignment="auto" variant="label-hidden" options={voucherValues} value={item.voucherNameField}
													name="voucherNameField" placeholder="Voucher Name" onchange={caltculateValue}>
												</lightning-combobox>
											</div>
											<div class="custom-cell">
												<label>Voucher Amount</label>
												<lightning-input type="number" variant="label-hidden"
													aria-required="true" value={item.voucherAmountField}
													name="voucherAmountField" class="read-only"
													placeholder="Voucher Amount" readonly disabled onkeyup={caltculateValue} step="0.01">
												</lightning-input>
											</div>
										</div>
										<div class="custom-row">
											<div class="custom-cell">
												<label>Membership Type </label>
												<lightning-combobox dropdown-alignment="auto"  variant="label-hidden" options={membershipValues} value={item.membershipTypeField}
													name="membershipTypeField" placeholder="Membership Type" onchange={caltculateValue}>
												</lightning-combobox>
											</div>
											<div class="custom-cell">
												<label>Membership  Amount</label>
												<lightning-input type="number" variant="label-hidden"
													aria-required="true" value={item.membershipAmountField}
													name="membershipAmountField" class="read-only" readonly disabled
													placeholder="Membership Amount" onkeyup={caltculateValue} step="0.01">
												</lightning-input>
											</div>
										</div>

										<div class="custom-row">
											<div class="custom-cell">
												<label> <strong>Net Impact %</strong> </label>
												<lightning-input type="text" variant="label-hidden"
													aria-required="true" value={item.netImpactField}
													name="netImpactField" placeholder="Net Impact %"
													onkeyup={handleKeyUp} readonly disabled class="read-only">
												</lightning-input>
											</div>
											<div class="custom-cell">
												<label> <strong>Net Offer Value</strong> </label>
												<lightning-input type="number" variant="label-hidden"
													aria-required="true" value={item.netOfferValueField}
													name="netOfferValueField" placeholder="Net Offer Value"
													onkeyup={handleKeyUp} readonly disabled  class="read-only" step="0.01">
												</lightning-input>
											</div>
										</div>

										<div class="custom-row">
											<div class="custom-cell">
												<lightning-file-upload
												label="Attach Files"
												name="fileUploader"
												accept={acceptedFormats}
												record-id={recordId}
												onuploadfinished={handleUploadFinished}
												multiple>
											</lightning-file-upload>
											</div>
											<div class="custom-cell">
												<template for:each={uploadedFileNames} for:item="fileData">
													<li key={fileData}>
														<lightning-pill label={fileData.name} name={fileData.documentId}  onremove={handleAttachmentRemove}></lightning-pill>
													</li>
												</template>
											</div>
										</div>

										
											
										</div>
									</template>
										
										
									</div>

									<lightning-card variant="Narrow" title="Installment Details">

										<template if:true={item.salesOfferDetails}>
											<template if:true={item.salesOfferDetails.applicablePaymentPlansCalculated}>
												<template
													for:each={item.salesOfferDetails.applicablePaymentPlansCalculated}
													for:item="paymentItem" for:index="paymentItemIndexVar">
													<template if:true={paymentItem.isSelected}>
														<div key={paymentItem}
															class="slds-p-bottom_small">
															<div
																class="slds-text-heading_xx-small slds-p-bottom_xx-small table-title">
																<b>{paymentItem.paymentPlanDetails.Name} </b></div>
															<table aria-multiselectable="true"
																class="slds-table slds-no-row-hover slds-table_bordered slds-table_col-bordered slds-table_edit "
																role="grid">
																<thead>
																	<tr class="slds-line-height_reset">
																		<th scope="col"
																			style="padding: var(--lwc-tableCellSpacing,0.25rem 0.5rem);">
																			Installment #
																		</th>
																		<th scope="col"
																			style="padding: var(--lwc-tableCellSpacing,0.25rem 0.5rem);">
																			Milestone
																		</th>
																		<th scope="col"
																			style="padding: var(--lwc-tableCellSpacing,0.25rem 0.5rem);">
																			Installment Percentage
																		</th>
																		<th scope="col"
																			style="padding: var(--lwc-tableCellSpacing,0.25rem 0.5rem);">
																			Broker Payout Percentage
																		</th>
																		<th scope="col"
																			style="padding: var(--lwc-tableCellSpacing,0.25rem 0.5rem);">
																			Installment Date
																		</th>

																		<template if:false={memoFlow}>
																			<th scope="col"
																				style="padding: var(--lwc-tableCellSpacing,0.25rem 0.5rem);">
																				Total
																			</th>
																		</template>
																			
																	</tr>
																</thead>
																<tbody>
																	<template if:true={paymentItem.installmentDetails}>
																		<template
																			for:each={paymentItem.installmentDetails}
																			for:item="installmentItem"
																			for:index="installmentItemIndexVar">
																			<tr key={installmentItem.installmentRecord.Id}
																				aria-selected="false"
																				class="slds-hint-parent">
																				<td class="slds-cell-edit"
																					role="gridcell" tabindex="0">
																						{installmentItem.installmentRecord.InstallmentNumber__c}
																				</td>
																				<td class="slds-cell-edit"
																					role="gridcell" tabindex="0">
																					{installmentItem.installmentRecord.Description__c}
																				</td>
																				<td class="slds-cell-edit"
																					role="gridcell" tabindex="0">
																					{installmentItem.installmentRecord.InstallmentPercentage__c}
																					%
																				</td>
																				<td class="slds-cell-edit"
																					role="gridcell" tabindex="0">
																					{installmentItem.installmentRecord.BrokerPayoutPercentage__c}
																					<template if:true={installmentItem.installmentRecord.BrokerPayoutPercentage__c}>&nbsp; %</template>
																					
																				</td>
																				<td class="slds-cell-edit"
																					role="gridcell" tabindex="0">
																					<lightning-formatted-date-time
																						value={installmentItem.installmentRecord.InstallmentDate__c}
																						year="2-digit" month="2-digit"
																						day="2-digit" >
																					</lightning-formatted-date-time>
																				</td>
																				
																				<template if:false={memoFlow}>
																					<td class="slds-cell-edit"
																						role="gridcell" tabindex="0">
																						<p> <lightning-formatted-number format-style="currency" class="table-input" value={installmentItem.totalValue} minimum-fraction-digits="2" maximum-fraction-digits="2" readonly currency-code={defaultCurrency} currency-display-as="code"></lightning-formatted-number></p>															
																					
																					</td>
																				</template>
																				
																			</tr>
																		</template>


																	</template>
																</tbody>
															</table>
															</br>
															</br>
															<template if:true={memoFlow}>
																<template if:true={paymentItem.installmentDetails}>
																	<lightning-card variant="Narrow" class="proposed-installments-section"
																		title="Proposed Installments">
																		<table
																			class="slds-table slds-table_cell-buffer slds-table_bordered proposed-installments-table">
																			<thead>
																				<tr class="slds-line-height_reset">

																					<td scope="col">
																						<lightning-input type="number"
																							variant="standard"
																							name="proposedInstallmentNumberField"
																							label="Proposed Installment Number"
																							value={proposedInstallmentNumberField}
                                                                                            
																							placeholder="Proposed Installment Number"
																							onchange={handleChange}>
																						</lightning-input>
																					</td>

																					<td scope="col">
																						<lightning-input type="date"
																							variant="standard"
																							name="proposedInstallmentDateField"
																							label="Proposed Installment Date"
																							value={proposedInstallmentDateField}

																							placeholder="Proposed Installment Date"
																							onchange={handleChange}>
																						</lightning-input>
																					</td>
																					<td scope="col">
																						<lightning-input type="number"
																							variant="standard"
																							name="proposedInstallmentRateField"
																							value={proposedInstallmentRateField}
																							label="Proposed Installment %"
																							placeholder="Proposed Installment %"
																							onkeyup={handleKeyUp}>
																						</lightning-input>
																					</td>
																					<td scope="col">
																						<lightning-input type="number"
																							variant="standard"
																							name="proposedBrokerPayoutField"
																							value={proposedBrokerPayoutField}
																							label="Proposed Broker %"
																							placeholder="Proposed Broker %"
																							onkeyup={handleKeyUp}>
																						</lightning-input>
																					</td>
																					<td scope="col">
																						<lightning-input type="text"
																							variant="standard"
																							name="proposedMilestoneField"
																							value={proposedMilestoneField}
																							label="Milestone"
																							placeholder="Milestone"
																							onkeyup={handleKeyUp}>
																						</lightning-input>
																					</td>

																				</tr>
																			</thead>
																		</table>
																		<div class="slds-align_absolute-center btns-container">
																			<button
																				class="slds-button slds-button_neutral custom-btn"
																				slot="actions"
																				onclick={addProposedInstallmentLineChanges}
																				style="padding: 5pt;">Add
																			</button>

																			<button
																				class="slds-button slds-button_neutral custom-btn"
																				slot="actions"
																				onclick={cloneInstallmentLines}
																				style="padding: 5pt;">Clone Installments
																			</button>
																		</div>
																		<div style="height: 200px;">
																			<lightning-datatable class="memo-lines-table" key-field="InstallmentNumber"
																				data={item.dataInstallmentLineChanges}
																				columns={columns}
																				hide-checkbox-column="true"
																				sorted-by={sortBy}
																				onrowaction={handleRowAction}
																				show-row-number-column="true"
																				sorted-direction={sortDirection}
																				draft-values={draftValues}
																				onsave={handleSave}>
																			</lightning-datatable>
																		</div>
																	</lightning-card>
																</template>
															</template>
														</div>
													</template>
												</template>
											</template>
										</template>
										<p slot="footer"></p>
									</lightning-card>
									<template if:false={memoFlow}>
										<lightning-card variant="Narrow" title="Offer Details">
											<template if:true={item.salesOfferDetails}>
												<template if:true={item.salesOfferDetails.offersAvailable}>
													<div class="slds-grid slds-wrap">
														<template if:true={item.salesOfferDetails.offerLinesApplied}>
															<div
																class="slds-text-heading_xx-small slds-p-bottom_xx-small table-title">
																<b>{item.salesOfferDetails.offerRecord.Name} </b></div>
															<table aria-multiselectable="true"
																class="slds-table slds-no-row-hover slds-table_bordered slds-table_col-bordered slds-table_edit "
																role="grid">
																<thead>
																	<tr class="slds-line-height_reset">
																		<th scope="col"
																			style="padding: var(--lwc-tableCellSpacing,0.25rem 0.5rem);">
																			Offer Type
																		</th>
																		<th scope="col"
																			style="padding: var(--lwc-tableCellSpacing,0.25rem 0.5rem);">
																			Offer On
																		</th>
																		<th scope="col"
																			style="padding: var(--lwc-tableCellSpacing,0.25rem 0.5rem);">
																			Value
																		</th>
																	</tr>
																</thead>
																<tbody>
																	<template
																		for:each={item.salesOfferDetails.applicableOfferLinesCalculated}
																		for:item="OfferItem" for:index="indexVar">
																		<tr key={OfferItem.Id} aria-selected="false"
																			class="slds-hint-parent">
																			<td class="slds-cell-edit" role="gridcell"
																				tabindex="0">
																				{OfferItem.OfferType__c}
																			</td>
																			<td class="slds-cell-edit" role="gridcell"
																				tabindex="0">
																				{OfferItem.OfferOn__c} <span if:true={OfferItem.DiscountType__c}>({OfferItem.DiscountType__c})</span>
																			</td>
																			<td class="slds-cell-edit" role="gridcell"
																				tabindex="0">
																				<lightning-formatted-number class="table-input" value={OfferItem.OfferValue__c}  minimum-fraction-digits="2" maximum-fraction-digits="2" readonly > &nbsp; </lightning-formatted-number><span if:true={OfferItem.OfferValueType__c}>{OfferItem.OfferValueType__c} </span>
																			</td>
																		</tr>
																	</template>
																</tbody>
															</table>
														</template>
														<template if:false={item.salesOfferDetails.offerLinesApplied}>
															No Offers Lines Applied
														</template>
													</div>
												</template>
												<template if:false={item.salesOfferDetails.offersAvailable}>
													No Offers applicable
												</template>
											</template>
											<p slot="footer"></p>
										</lightning-card>
									</template>
								</lightning-tab>
							</template>

						</lightning-tabset>
					</div>
				</div>
			</div>
		</template>
		<!-- Page 2 End -->
		<!-- Page 3 Start -->
		<template if:true={showPage3}>
			<template if:true={reserveFlow}>
				<div class="slds-card__body">

					<template if:true={BookingWizard}>
						<div class="slds-grid slds-wrap slds-p-bottom_small slds-border_bottom">
							<template if:true={ICACheckRequired}>
								<div class="filter-col slds-col slds-size_3-of-12">
									<lightning-input type="file" variant="label-stacked" required label="ICA Verified" class="icaVerificationConfirm" onchange={handleBookingButtonDisplay}></lightning-input>
									<div if:true={fileData}>{fileData.filename}</div> 
								</div>
							</template>

							<div class="filter-col slds-col slds-size_3-of-12">

								<div class="check-box-container check-box-container-vertical">
									<label >Customer Contact Details are Verified <span style="color: red;">*</span></label>
									<lightning-input type="checkbox" variant="label-stacked" required label="" class="bookingConfirmationConfirm hide-astrisk" onchange={handleBookingButtonDisplay}></lightning-input>

								</div>
								
							</div>
							
							<div class="filter-col slds-col slds-size_3-of-12">
								<lightning-combobox dropdown-alignment="auto" class="bookingConfirmationWinReason" label="Win Reason" variant="label-stacked"
									placeholder="Win Reason" required onchange={handleBookingButtonDisplay} value={winReasonVal}
									options={winReasonOptions}>
								</lightning-combobox>
							</div>
							<template if:true={availableEOIs}>
								<div class="filter-col slds-col slds-size_3-of-12">
									<lightning-combobox dropdown-alignment="auto" class="eoi" label="Select EOI" variant="label-stacked"
									placeholder="EOI"
									options={availableEOIs}>
								</lightning-combobox>
								</div>
							</template>
							<div class="filter-col slds-col slds-size_3-of-12 book-units-container"  style="padding-top: 1.3rem;">
								<lightning-button class="slds-float_right" variant="brand"
														name="Book Unit(s)" label="Book Unit(s)" disabled={disableBookingButton}
														onclick={handleBooking}></lightning-button>
							</div>
						</div>
					
					</template>
					<div class="slds-grid slds-container--fluid slds-gutters slds-grid_vertical-align-top">
						<div class="filter-col slds-col slds-size_12-of-12">
							<div class="slds-grid slds-wrap slds-p-around_small box-container">
								<div class="filter-col slds-col slds-size_4-of-12">
									<label style="font-weight:bold">Sale Type</label>
									<lightning-input type="text" variant="label-hidden"
										aria-required="true" 
										name="opportunitySaleType"
										value={sObjectRecord.SaleType__c}
										onkeyup={handleKeyUp}
										readonly>
									</lightning-input>

									<label style="font-weight:bold">Deal Type</label>
									<lightning-input type="text" variant="label-hidden"
										aria-required="true" 
										name="opportunityDealType" value={sObjectRecord.DealType__c}
										onkeyup={handleKeyUp}
										readonly>
									</lightning-input>

									<label style="font-weight:bold">Booking Type</label>
									<lightning-input type="text" variant="label-hidden"
										aria-required="true" 
										name="opportunityBookingType" value={sObjectRecord.BookingType__c}
										onkeyup={handleKeyUp}
										readonly>
									</lightning-input>

									<label style="font-weight:bold">Agent Type</label>
									<lightning-input type="text" variant="label-hidden"
										aria-required="true" 
										name="opportunityAgentType" value={sObjectRecord.AgentType__c}
										onkeyup={handleKeyUp}
										readonly>
									</lightning-input>

									
									
								</div>

								<div class="filter-col slds-col slds-size_4-of-12">
									
									
									<template if:false={sObjectRecord.BrokerAgencyAccount__r} >
										<lightning-input type="text" variant="label-hidden"
											aria-required="true" 
											name="opportunityBrokerAgencyName" value=""
											onkeyup={handleKeyUp}
											readonly>
										</lightning-input>
									</template>
									<label style="font-weight:bold">Bank Name</label>
									<lightning-input type="text" variant="label-hidden"
										aria-required="true" 
										name="opportunityBankName" value={sObjectRecord.BankName__c}
										onkeyup={handleKeyUp}
										readonly>
									</lightning-input>

									<label style="font-weight:bold">Referral Type</label>
									<lightning-input type="text" variant="label-hidden"
										aria-required="true" 
										name="opportunityReferralType" value={sObjectRecord.ReferralType__c}
										onkeyup={handleKeyUp}
										readonly>
									</lightning-input>

									<label style="font-weight:bold">Delivery Method</label>
									<lightning-input type="text" variant="label-hidden"
										aria-required="true" 
										name="opportunityDeliveryMethod" value={sObjectRecord.DeliveryMethod__c}
										onkeyup={handleKeyUp}
										readonly>
									</lightning-input>
								</div>

								<div class="filter-col slds-col slds-size_4-of-12">
									<label style="font-weight:bold">Broker Agency Name</label>
									<template if:true={sObjectRecord.BrokerAgencyAccount__r} >
										<lightning-input type="text" variant="label-hidden"
											aria-required="true" 
											name="opportunityBrokerAgencyName" value={sObjectRecord.BrokerAgencyAccount__r.Name}
											onkeyup={handleKeyUp}
											readonly>
										</lightning-input>
									</template>
                                    
									<label style="font-weight:bold">Broker Agent Name</label>
									<lightning-input type="text" variant="label-hidden"
										aria-required="true" 
										name="opportunityBrokerAgentName" value={sObjectRecord.BrokerAgentName__c}
										onkeyup={handleKeyUp}
										readonly>
									</lightning-input>

									<label style="font-weight:bold">Corporate Partner</label>
									<lightning-input type="text" variant="label-hidden"
										aria-required="true" 
										name="opportunityCorporatePartner" value={sObjectRecord.Account.CorporateWealthName__c}
										onkeyup={handleKeyUp}
										readonly>
									</lightning-input>
								</div>
							</div>
						</div>
					</div>
				</div>
			</template>
			<div class="slds-card__body">
				<div class="slds-grid slds-container--fluid slds-gutters slds-grid_vertical-align-top">
					<div class="filter-col slds-col slds-size_12-of-12">

						<template if:true={OfferWizard}>
							<lightning-tabset variant="scoped">
								<template for:each={selectedUnitList} for:item="item" for:index="indexVar">
									
									<lightning-tab key={item.unitId} label={item.unitName} data-target-type="tab"
										data-unit-id={item.unitId} value={item.unitId} onactive={handlePDFActive}>

										<lightning-card variant="Narrow" title="Offer Details">
											<template if:false={unitWizard}>
											<lightning-button slot="actions" name="Email Current Offer"
												label="Email Current Offer" data-unit-id={item.unitId}
												onclick={sendSalesOfferEmail}></lightning-button> &nbsp;
												<lightning-button slot="actions" name="Email All Offers"
													label="Email All Offers" onclick={sendSalesOfferEmail}>
												</lightning-button>
											</template>
											<div class="customer-name-container">
												<label for="">Customer Name</label>
												<div>
													<lightning-input type="text" class="customer-name-input"
													data-target-type="input" data-unit-id={item.unitId}
													variant="label-inline" value={customerName}
													onchange={handlePDFActive}></lightning-input>
												</div>
												
											</div>
											<iframe scrolling="auto" style="width:100%" height="1000"
												src={fullUrl}></iframe>
											<br />
											<!-- {fullUrl} -->
											<p slot="footer"></p>
										</lightning-card>
									</lightning-tab>
								</template>

							</lightning-tabset>
						</template>
						<template if:true={ReservationWizard}>
							<lightning-tabset variant="scoped">
								<template for:each={selectedUnitList} for:item="item" for:index="indexVar">
									<lightning-tab key={item.unitId} label={item.unitName} data-target-type="tab"
										data-unit-id={item.unitId} value={item.unitId} onactive={handleReserveChoice}>

										<lightning-card variant="Narrow" title="Reservation Confirmation">
											<div class="slds-grid slds-wrap slds-p-around_small box-container">
												<div class="filter-col slds-col slds-size_6-of-12">

												<label style="font-weight:bold">Selling Price</label>
												<lightning-input type="number" variant="label-hidden"
													aria-required="true" value={item.salesOfferDetails.unitRecord.SellingPrice__c}
													name="reservationSellingPrice"
													placeholder="Selling Price" onkeyup={handleKeyUp}
													readonly >
												</lightning-input>
												<template if:true={selectedPaymentCalculatedJS}>
													<label style="font-weight:bold">Payable Price</label>
													<lightning-input type="number" variant="label-hidden"
														aria-required="true" value={selectedPaymentCalculatedJS.netSalesPrice}
														name="reservationPayablePrice"
														placeholder="Payable Price" onkeyup={handleKeyUp}
														readonly>
													</lightning-input>
													
													<label style="font-weight:bold">Rebate (Upon Handover)</label>
													<lightning-input type="number" variant="label-hidden"
														aria-required="true" value={selectedPaymentCalculatedJS.rebateAmount}
														name="reservationRebate"
														placeholder="Rebate (Upon Handover)" onkeyup={handleKeyUp}
														readonly>
													</lightning-input>
												</template>
												</div>
												<template if:true={selectedPaymentCalculatedJS}>
													<div class="filter-col slds-col slds-size_6-of-12">
													
													<label style="font-weight:bold">Total Discount</label>
													<lightning-input type="number" variant="label-hidden"
														 value={selectedPaymentCalculatedJS.discountAmount}
														name="reservationTotalDiscount"
														placeholder="Total Discount" onkeyup={handleKeyUp}
														readonly>
													</lightning-input>

													<label style="font-weight:bold">Partner Discount</label>
													<lightning-input type="number" variant="label-hidden"
														 value={selectedPaymentCalculatedJS.partnerDiscountAmount}
														name="reservationPartnerDiscount"
														placeholder="Partner Discount" onkeyup={handleKeyUp}
														readonly>
													</lightning-input>

													</div>
												</template>
											</div>
										</lightning-card>
										<lightning-card variant="Narrow" title="Unit Details" >
											<div class="slds-grid slds-wrap slds-p-around_small box-container" >
												<div class="filter-col slds-col slds-size_4-of-12">

												<label style="font-weight:bold">Unit Type</label>
												<lightning-input type="text" variant="label-hidden"
													 value={item.salesOfferDetails.unitRecord.UnitType__c}
													name="unitType"
													onkeyup={handleKeyUp}
													readonly>
												</lightning-input>

												<label style="font-weight:bold">Unit Name</label>
												<lightning-input type="text" variant="label-hidden"
													 value={item.salesOfferDetails.unitRecord.Name}
													name="unitName"
													onkeyup={handleKeyUp}
													readonly>
												</lightning-input>
												
												<label style="font-weight:bold">Rooms</label>
												<lightning-input type="text" variant="label-hidden"
													 value={item.salesOfferDetails.unitRecord.TotalRooms__c}
													name="unitRooms"
													onkeyup={handleKeyUp}
													readonly>
												</lightning-input>

												</div>
												<div class="filter-col slds-col slds-size_4-of-12">
													<label style="font-weight:bold">Terrace Area</label>
													<lightning-input type="text" variant="label-hidden"
													 value={item.salesOfferDetails.unitRecord.TerraceArea__c}
													name="unitTerraceArea"
													onkeyup={handleKeyUp}
													readonly>
													</lightning-input>

													<label style="font-weight:bold">Reservation Amount</label>
													<template if:true={item.salesOfferDetails.unitRecord.BuildingSectionName__c}>
														<template if:true={item.salesOfferDetails.unitRecord.BuildingSectionName__r.ReservationAmount__c}>
															<lightning-input type="text" variant="label-hidden"
															 value={item.salesOfferDetails.unitRecord.BuildingSectionName__r.ReservationAmount__c} 
															name="unitReservationAmount"
															onkeyup={handleKeyUp}
															readonly>
															</lightning-input>
														</template>
														<template if:false={item.salesOfferDetails.unitRecord.BuildingSectionName__r.ReservationAmount__c}>
															<lightning-input type="text" variant="label-hidden"
															 value={item.salesOfferDetails.unitRecord.Project__r.ReservationAmount__c} 
															name="unitReservationAmount"
															onkeyup={handleKeyUp}
															readonly>
															</lightning-input>
														</template>
													</template>
													<template if:true={selectedPaymentCalculatedJS}>
														<template if:true={selectedPaymentCalculatedJS.multiPurposeAmountApplicable}>
														   <label style="font-weight:bold">Multi-purpose Room</label>
														   <lightning-input type="text" variant="label-hidden"
														    value={item.multipurposeamount}
														   name="unitMultiPurposeRoom"
														   onkeyup={handleKeyUp}
														   readonly>
														   </lightning-input>
													   </template>
												   </template>
												</div>

												<div class="filter-col slds-col slds-size_4-of-12">
													

													<label style="font-weight:bold">Unit Finish</label>
													<lightning-input type="text" variant="label-hidden"
														value={item.unitFinishes}
														name="unitFinish"
														onkeyup={handleKeyUp}
														readonly>
													</lightning-input>
													<label style="font-weight:bold">Saleable Area</label>
													<lightning-input type="text" variant="label-hidden"
														 value={item.salesOfferDetails.unitRecord.SaleableArea__c}
														name="unitSaleableArea"
														onkeyup={handleKeyUp}
														readonly>
													</lightning-input>

													
												
												</div>
											</div>

											<div class="payment-details-container">
												<h1 class="box-title">Payment Details</h1>
												<div class="slds-grid slds-wrap slds-p-around_small box-container">
													<div class="filter-col slds-col slds-size_6-of-12">
	
														<lightning-combobox dropdown-alignment="auto" name={item.unitId}
															label="Select Reservation Amount"
															placeholder="Select Reservation Amount" required
															value={item.reservationAmountType}
															options={paymentAmountOptionsForReservation}
															onchange={handleReservationAmountTypeChange}>
														</lightning-combobox>
														<lightning-input class="slds-p-around_xx-top" type="number"
															disabled={item.disableAmountInput}
															value={item.reservationAmount} name={item.unitId}
															label="Reservation Amount" required
															onchange={handlePaymentAmountChange}></lightning-input>
													</div>
													<div class="filter-col slds-col slds-size_6-of-12">
	
														<lightning-combobox dropdown-alignment="auto" name={item.unitId} label="Select Payment Mode"
															placeholder="Select Payment Mode" required
															value={item.paymentMethod}
															options={paymentOptionsForReservation}
															onchange={handlePaymentMethodChange}></lightning-combobox>
													</div>
												</div>
											</div>
										</lightning-card>
									</lightning-tab>
								</template>

							</lightning-tabset>
						</template>
						<template if:true={BookingWizard}>
							<lightning-tabset variant="scoped">
								<template for:each={selectedUnitList} for:item="item" for:index="indexVar">
									<lightning-tab key={item.unitId} label={item.unitName} data-target-type="tab"
										data-unit-id={item.unitId} value={item.unitId} onactive={handleReserveChoice}>
										<lightning-card variant="Narrow" title="Booking Confirmation">
											<div class="slds-grid slds-wrap slds-p-around_small box-container" style="margin-bottom: 1rem;">
												<div class="filter-col slds-col slds-size_4-of-12">
													<label style="font-weight:bold">Property Name</label>
														<lightning-input type="text" variant="label-hidden"
														 value={item.salesOfferDetails.unitRecord.Project__r.Name}
														name="PropertyName"
														readonly>
													</lightning-input>
													<template if:true={selectedPaymentCalculatedJS}>
													<label style="font-weight:bold">Payment Plan</label>
													<lightning-input type="text" variant="label-hidden"
														 data-record-id={item.unitId} value={selectedPaymentCalculatedJS.paymentPlanDetails.Name}
														name="selectedPaymentPlanName" class="selectedPaymentPlanName"
														readonly>
													</lightning-input>
													</template>
													<template if:true={item.salesOfferDetails.offerRecord}>
													<label style="font-weight:bold">Offer Name</label>
														<lightning-input type="text" variant="label-hidden"
															 value={item.salesOfferDetails.offerRecord.Name}
															name="OfferName"
															readonly>
														</lightning-input>
													</template>
												</div>
												<template if:true={selectedPaymentCalculatedJS}>
												<div class="filter-col slds-col slds-size_4-of-12">
													<label style="font-weight:bold">Payable Price</label>
													<lightning-input type="number" variant="label-hidden"
														 value={selectedPaymentCalculatedJS.netSalesPrice}
														name="PayablePrice"
														readonly>
													</lightning-input>

													<label style="font-weight:bold">Selling Price</label>
													<lightning-input type="number" variant="label-hidden"
														 value={item.salesOfferDetails.unitRecord.SellingPrice__c}
														name="SellingPrice"
														readonly>
													</lightning-input>

													<label style="font-weight:bold">Total Discount</label>
													<lightning-input type="number" variant="label-hidden"
														 value={selectedPaymentCalculatedJS.discountAmount}
														name="TotalDiscount"
														placeholder="Total Discount" 
														readonly>
													</lightning-input>

												</div>
												</template>
											</div>
											<div class="slds-grid slds-wrap slds-p-around_small box-container" >
												<!-- EXP-->
												<div class="filter-col slds-col slds-size_4-of-12">
													<label style="font-weight:bold">Unit Type</label>
													<lightning-input type="text" variant="label-hidden"
														 value={item.salesOfferDetails.unitRecord.UnitType__c}
														name="unitType"
														
														readonly>
													</lightning-input>

													<label style="font-weight:bold">Unit Name</label>
													<lightning-input type="text" variant="label-hidden"
														 value={item.salesOfferDetails.unitRecord.Name}
														name="unitName"
														
														readonly>
													</lightning-input>

													<label style="font-weight:bold">Rooms</label>
													<lightning-input type="text" variant="label-hidden"
														 value={item.salesOfferDetails.unitRecord.TotalRooms__c}
														name="unitRooms"
														
														readonly>
													</lightning-input>

													<label style="font-weight:bold">Saleable Area</label>
													<lightning-input type="number" variant="label-hidden"
														 value={item.salesOfferDetails.unitRecord.SaleableArea__c}
														name="unitRooms"
														readonly>
													</lightning-input>


												</div>
												<div class="filter-col slds-col slds-size_4-of-12">
													<label style="font-weight:bold">Terrace Area</label>
													<lightning-input type="number" variant="label-hidden"
														 value={item.salesOfferDetails.unitRecord.TerraceArea__c}
														name="unitRooms"
														readonly>
													</lightning-input>

													<label style="font-weight:bold">Price</label>
													<lightning-input type="number" variant="label-hidden"
														 value={item.salesOfferDetails.unitRecord.SellingPrice__c}
														name="unitRooms"
														readonly>
													</lightning-input>

													<label style="font-weight:bold">Delivery method</label>
												</div>	
												<div class="filter-col slds-col slds-size_4-of-12">
													<label style="font-weight:bold">Subsidy Years</label>
														<lightning-input type="text" variant="label-hidden"
														 value={sObjectRecord.SubsidyYears__c}
														name="opportunitySubsidyYears"
														
														readonly>
													</lightning-input> 
													
													
													<template if:true={item.salesOfferDetails.multiPurposeAmountApplicable}>
													<label style="font-weight:bold">Multi purpose</label>
													<lightning-input type="checkbox" variant="label-hidden"
														 checked disabled
														name="unitRooms" readonly>
													</lightning-input>
													<label style="font-weight:bold">Multi purpose Amount</label>
													<lightning-input type="number" variant="label-hidden" 
														 value={item.salesOfferDetails.unitRecord.MultiPurposeAmount__c}
														name="unitRooms"
														readonly>
													</lightning-input>
													</template>
													<template if:false={item.salesOfferDetails.multiPurposeAmountApplicable}>
														<label style="font-weight:bold">Multi purpose</label>
													<lightning-input type="checkbox" variant="label-hidden"
														 disabled
														name="unitRooms" readonly>
													</lightning-input>
													</template>
												</div>
											</div>
											<div slot="footer" class="slds-grid slds-wrap">
												<div class="filter-col slds-col slds-size_3-of-12">
													<label style="font-weight:bold" class="slds-text-title_bold slds-float_left">Total</label>
													<lightning-input type="number" label="Total" variant="label-hidden"
														 value={item.salesOfferDetails.totalOfAllUnitNetSellingPrice}
														name="PayablePrice"
														readonly>
													</lightning-input>
												</div>
												<!--<div class="filter-col slds-col slds-size_3-of-12">
													<label style="font-weight:bold" class="slds-text-title_bold slds-float_left">Mortgage Applicable</label>
													<lightning-combobox dropdown-alignment="auto" name="mortgageApplicable" variant="label-hidden" required placeholder="Mortgage Applicable"
															options={mortgageApplicableVals} onchange={handleMortgageChange} data-record-id={item.unitId} class="mortgageApplicableField"></lightning-combobox>
												</div>
												<div class="filter-col slds-col slds-size_3-of-12">
													<template if:true={item.mortgageApplicable}>
													<label style="font-weight:bold" class="slds-text-title_bold slds-float_left">Mortgage Bank </label>
													<lightning-combobox dropdown-alignment="auto" name="mortgageBank" variant="label-hidden" 
															options={mortgageBankVals} onchange={handleMortgageBankChange} required data-record-id={item.unitId} class="mortgageBankField"></lightning-combobox>
													</template>
												</div>-->
												<div class="filter-col slds-col slds-size_3-of-12">
													<lightning-button class="slds-float_right" variant="brand"
														name="Book Unit(s)" label="Book Unit(s)" disabled={disableBookingButton}
														onclick={handleBooking}></lightning-button>
												</div>
											</div>
										</lightning-card>
									</lightning-tab>
								</template>

							</lightning-tabset>
						</template>
					</div>
				</div>
			</div>

		</template>
		<!-- Page 3 End -->
		<template if:true={showBudgetModal}>
			<c-check-budget project-budget-id={projectRecord.ProjectBudget__c} onclose={closeModal} open-modal={showBudgetModal}></c-check-budget>
		</template>
		
	</article>
</template>
</template>