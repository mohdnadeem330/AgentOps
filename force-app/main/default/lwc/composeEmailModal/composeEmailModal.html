<template>
    <div class="modal-container">
        <!-- Modal/Popup Box LWC starts here -->
    <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true" aria-describedby="modal-content-id-1" class="aldar-modal slds-modal slds-fade-in-open">
      <div class="slds-modal__container">
          <!-- Modal/Popup Box LWC header here -->
          <header class="slds-modal__header">
              <button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" title="Close" onclick={closeModal}>
                  <lightning-icon icon-name="utility:close"
                      alternative-text="close"
                      variant="inverse"
                      size="small" ></lightning-icon>
                  <span class="slds-assistive-text">Close</span>
              </button>
              <h2 id="modal-heading-01" class="slds-text-heading_medium slds-hyphenate">{modalheader}</h2>
          </header>
          <!-- Modal/Popup Box LWC body starts here -->
          <div class="slds-modal__content slds-p-around_medium" id="modal-content-id-1" style="height: 380px;">
           <div class="main-container" >
            <lightning-card  variant="Narrow" >
                <div class="spinner">
                    <template if:true={isLoading}>
                        <lightning-spinner alternative-text="Loading" variant="brand" size="large">
                        </lightning-spinner>
                    </template>
                </div>
                <template if:false={isPublished}>
                    <lightning-record-edit-form record-id={recordId} object-api-name="CommunicationTemplate__c" onsubmit={handleSubmit} onsuccess={handleSuccess} onload={handleLoad} onerror={handleError} >
                        <lightning-accordion allow-multiple-sections-open active-section-name={activeSections}>
                            <lightning-accordion-section name="CommunicationType" label="Communication Type" >
                                <div class="slds-grid slds-wrap">
                                    <div class="slds-col slds-size_2-of-2">
                                        <lightning-messages></lightning-messages>
                                    </div>
            
                                    <div class="slds-col slds-size_1-of-2">
                                        <lightning-input-field variant="label-stacked" required field-name="Type__c" value={communicationTypeValue} disabled  ></lightning-input-field>
                                    </div>
                                    <div class="slds-col slds-size_1-of-2">
                                        <lightning-input-field variant="label-stacked" required field-name="Status__c" disabled={isPublished} ></lightning-input-field>
                                    </div>
                                    
                                        <!--<div class="slds-col slds-size_1-of-2">
                                            <lightning-input-field variant="label-stacked" field-name="Compliance__c" disabled={isPublished} onchange={handleComplaiceChange}></lightning-input-field>
                                        </div>
                                        
                                        <div class="slds-col slds-size_1-of-2">
                                            <lightning-input-field variant="label-stacked" field-name="Offense__c" disabled={isPublished} required={complaiance}></lightning-input-field>
                                        </div>
                                        <div class="slds-col slds-size_1-of-2">
                                            <lightning-input-field variant="label-stacked" field-name="SuspensionStartDate__c" disabled={isPublished} required={complaiance}></lightning-input-field>
                                        </div>
                                        <div class="slds-col slds-size_1-of-2">
                                            <lightning-input-field variant="label-stacked" field-name="SuspensionEndDate__c" disabled={isPublished} required={complaiance}></lightning-input-field>
                                        </div> -->
                                    
                                </div>
                            </lightning-accordion-section>
                            <lightning-accordion-section name="MessageDetails" label="Message Details">
                                <div class="slds-grid slds-wrap">
                                    <div class="slds-col slds-size_1-of-1">
                                        <lightning-input-field variant="label-stacked" required field-name="Title__c" disabled={isPublished}></lightning-input-field>
                                    </div>
                                    <div class="slds-col slds-size_1-of-1">
                                        <lightning-input-field variant="label-stacked" required field-name="PlainTextBody__c" disabled={isPublished}></lightning-input-field>
                                    </div>
                                    <div if:true={isEmailCommincation} class="slds-col slds-size_1-of-1">
                                        <lightning-input-field variant="label-stacked" required field-name="HTMLBody__c" disabled={isPublished}></lightning-input-field>
                                    </div>
                                    <template if:true={isEmailCommincation}>
                                        <div class="slds-col slds-size_1-of-1">
                                            <lightning-file-upload label="Attachment" name="fileUploader"  record-id={myRecordId} onuploadfinished={handleUploadFinished}  multiple></lightning-file-upload>
                                            <template for:each={uploadedFiles} for:item="fileData">
                                                <li key={fileData}>
                                                    <lightning-pill label={fileData.name} name={fileData.documentId}  onremove={handleAttachmentRemove}></lightning-pill>
                                                </li>
                                            </template>
                                        </div>
                                    </template>
                                </div>
                            </lightning-accordion-section>
                            <lightning-accordion-section name="AgencyDetails" label="Agency Details">
                                <lightning-dual-listbox name="languages" disabled={isPublished}
                                        label="Agency List"
                                        source-label="Available"
                                        selected-label="Selected"
                                        options={agencyList}
                                        value={selectedAgencies} 
                                        onchange={handleAgencyChange} ></lightning-dual-listbox>
            
                            </lightning-accordion-section>
                            <lightning-accordion-section name="AgentDetails" label="Agent Details">
                                <lightning-dual-listbox name="languages" disabled={isPublished}
                                        label="Agent List"
                                        source-label="Available"
                                        selected-label="Selected"
                                        options={agentList}
                                        value={selectedAgents}  onchange={handleAgentChange}></lightning-dual-listbox>
            
                            </lightning-accordion-section>
                        </lightning-accordion>
                        <!--<div class="slds-grid bottomBar slds-wrap">
                            <div class="slds-col slds-size_2-of-2 slds-float_right slds-border_top slds-p-around_small">
                                <div style="display:flex;align-items:center">
                                    <button class="aldar-btn" type="Cancel" label="Cancel" onclick={handleNavigation} style="min-width: 180px;margin-right: 24px;">Cancel</button>
                                    <button style="display: none;" class="aldar-btn aldar-btn-black-bg submitCom" disabled={isPublished} variant="brand" type="submit" label="Save" style="min-width: 180px;margin-right: 24px;" >Submit</button> &nbsp;&nbsp;
                                </div>
                            </div>
                        </div>-->
                        <button style="display: none;" class="aldar-btn aldar-btn-black-bg submitCom" disabled={isPublished}  type="submit" >Submit</button> &nbsp;&nbsp;
                    </lightning-record-edit-form>
                </template>
                <template if:true={isPublished}>
                    <template if:true={recordId}>
                        <lightning-record-view-form record-id={recordId} object-api-name="CommunicationTemplate__c"  onload={handleLoad}  >
                            <div class="slds-grid slds-wrap">
                            
                                <div if:false={isEmailCommincation} class="slds-col slds-size_1-of-1">
                                    <lightning-output-field variant="label-hidden" required field-name="PlainTextBody__c" disabled={isPublished}></lightning-output-field>
                                </div>
                                <div if:true={isEmailCommincation} class="slds-col slds-size_1-of-1">
                                    <lightning-output-field variant="label-hidden" required field-name="HTMLBody__c" disabled={isPublished}></lightning-output-field>
                                </div>
                                <br/>
                                <template if:true={isEmailCommincation}>
                                    <div class="slds-col slds-size_1-of-1">
                                        <template for:each={uploadedFiles} for:item="fileData">
                                            <li key={fileData}>
                                                <lightning-pill label={fileData.name} name={fileData.documentId}  ></lightning-pill>
                                            </li>
                                        </template>
                                    </div>
                                </template>
                                <br/>
                                <template if:true={viewFlag}>                           
                                    <lightning-dual-listbox name="agencyList" disabled={isPublished}
                                            label="Agency List"
                                            source-label="Available"
                                            selected-label="Selected Agencies"
                                            options={agencyList}
                                            value={selectedAgencies} 
                                            onchange={handleAgencyChange} ></lightning-dual-listbox>
                
                                
                                    <lightning-dual-listbox name="AgentList" disabled={isPublished}
                                            label="Agent List"
                                            source-label="Available"
                                            selected-label="Selected Agents"
                                            options={agentList}
                                            value={selectedAgents}  onchange={handleAgentChange}></lightning-dual-listbox>
                
                                </template>
                            </div>
                        </lightning-record-view-form>
                    </template>
                </template>
            </lightning-card>
       


            
               <!-- <div class="row" > 

                <div class="left-side"><lightning-input class="aldar-input"  type="text" placeholder="Agency Name*" ></lightning-input></div>


                <div class="right-side">
                <lightning-combobox class="aldar-combo-box" placeholder="Title*" ></lightning-combobox>
                </div>


               </div> -->
  
               <!-- <div class="row" > 
                <lightning-combobox class="aldar-combo-box" placeholder="Type" options={typePickListValues} 
                name="typePickListField" value={typePickListField} onchange={handleChange}> </lightning-combobox>

               </div> 

               <div class="row" > 
                <lightning-combobox class="aldar-combo-box" placeholder="Status" options={statusPickListValues}  
                name="statusPickListField" value={statusPickListField} onchange={handleChange}> </lightning-combobox>
               </div> 
               <div class="row" >
                <lightning-input class="aldar-input"  type="text" placeholder="Title" data-id="titleField"></lightning-input>
               </div> 

               <div class="row" >
                <lightning-textarea name="Body" label="Body" placeholder="Body*"  class="aldar-text-area" data-id="bodyField"></lightning-textarea>
            </div>

            <div class="row" >
                <lightning-dual-listbox 
                label="Agency List"
                source-label="Available"
                selected-label="Selected"
                field-level-help="Select Agency"
                options={agencyPickListValues}
                name="agencyField" 
                value={agencyField}
                onchange={handleChange}></lightning-dual-listbox>
            </div>

            <div class="row" >
                <lightning-dual-listbox 
                label="Agent List"
                source-label="Available"
                selected-label="Selected"
                field-level-help="Select Agent"
                options={agentPickListValues}
                name="agentField" 
                value={agentField}
                onchange={handleChange}></lightning-dual-listbox>
            </div>
            
            

              <div class="row upload-row" > 
                   <p> <b>Attachments</b> (max file size for each attachment should be 2MB) </p>
                <div class="upload-main-container">
                    <span class="upload-label" style="width:150px;">Add Attachments</span>
                    <lightning-input class="aldar-upload-field" type="file" accept={acceptedFormats}
                        data-id="uploadedFiles" onchange={openfileUpload}
                        multiple="true" >
                    </lightning-input>

                    
                        <div class="uploaded-file-names-container">
                            <template for:each={uploadedFilesList} for:item="file">
                                <div key={file.filename} class="uploaded-file-item">
                                    <img src={uploadeFileIcon} class="uploaded-file-icon">
                                    <p class="uploaded-file-name-txt">{file.filename}</p>
                                    <a class="remove-file-wrapper" onclick={removeFile}
                                        data-id={file.filename}
                                        data-listname="uploadedFilesList"><img
                                            src={deleteFileIcon}></a>
                                </div>
                            </template>
                        </div>
                  
                </div>
               </div> -->
              

           </div>

           
  
          </div>
          <!-- Modal/Popup Box LWC footer starts here -->
          <footer class="slds-modal__footer" >
              <button class="aldar-btn" onclick={closeModal} title="Cancel" style="min-width: 180px;margin-right: 24px;">Cancel</button>
              <template if:false={isPublished}>
                <button class="aldar-btn aldar-btn-black-bg" onclick={submitDetails} title="OK" style="min-width: 180px;">Submit</button>
              </template>
          </footer>
      </div>
  </section>
  <div class="slds-backdrop slds-backdrop_open"></div>
  </div>
</template>